"use strict";(self.webpackChunkadmin_angular=self.webpackChunkadmin_angular||[]).push([[586],{586:(gn,J,i)=>{i.r(J),i.d(J,{FunctionModule:()=>dn});var h=i(8583),r=i(3679),v=i(9790),f=i(6271),T=i(5392),C=i(4453),U=i(464),z=i(7674),x=i(7018),p=i(6795),B=i(2746),Z=i(5887),D=i(8058),q=i(269),_=i(4788),O=i(1841),S=i(4828),g=i(5987),V=i(9765),G=i(5917),L=i(6782),I=i(8002),j=i(9773),E=i(3815),Y=i.n(E),H=i(2340),u=i(7071),n=i(7716),K=i(4701),w=i(2250),N=i(4514),R=i(6704),$=i(9374),X=i(9206);function W(o,l){1&o&&(n.ynx(0),n._UZ(1,"i",16),n.BQk())}function k(o,l){if(1&o&&n._UZ(0,"img",17),2&o){const t=n.oxw();n.Q6J("src",t.validateForm.controls.symbolUrl.value||"",n.LSH)}}function nn(o,l){if(1&o&&(n._uU(0),n.ALo(1,"emojiFlagFromLanguageCode"),n.ALo(2,"translate"),n.ALo(3,"lowercase")),2&o){const t=n.oxw().$implicit;n.AsE("",n.lcZ(1,2,t.value.language)," ",n.lcZ(2,4,"language."+n.lcZ(3,6,t.value.language)),"")}}const tn=function(){return{minRows:5,maxRows:10}};function en(o,l){if(1&o&&(n.TgZ(0,"nz-tab",18),n.YNc(1,nn,4,8,"ng-template",null,19,n.W1O),n.TgZ(3,"nz-form-item"),n.TgZ(4,"nz-form-label"),n._uU(5),n.ALo(6,"translate"),n.qZA(),n.TgZ(7,"nz-form-control",20),n.ALo(8,"translate"),n.TgZ(9,"nz-select",21),n._UZ(10,"nz-option",22),n.ALo(11,"translate"),n._UZ(12,"nz-option",22),n.ALo(13,"translate"),n._UZ(14,"nz-option",22),n.ALo(15,"translate"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(16,"nz-form-item"),n.TgZ(17,"nz-form-label"),n._uU(18),n.ALo(19,"translate"),n.qZA(),n.TgZ(20,"nz-form-control",20),n.ALo(21,"translate"),n._UZ(22,"input",23),n.qZA(),n.qZA(),n.TgZ(23,"nz-form-item"),n.TgZ(24,"nz-form-label"),n._uU(25),n.ALo(26,"translate"),n.qZA(),n.TgZ(27,"nz-form-control",24),n._UZ(28,"textarea",25),n.qZA(),n.qZA(),n.qZA()),2&o){const t=l.index,e=n.MAs(2),a=n.oxw();n.Q6J("formGroupName",t)("nzTitle",e)("nzClosable",a.translations.controls.length>1),n.xp6(5),n.Oqu(n.lcZ(6,15,"common.language")),n.xp6(2),n.s9C("nzErrorTip",n.lcZ(8,17,"ui.form.should_not_be_empty")),n.xp6(3),n.Q6J("nzValue",a.LanguageCode.Vi)("nzLabel","\u{1f1fb}\u{1f1f3} "+n.lcZ(11,19,"language.vi")),n.xp6(2),n.Q6J("nzValue",a.LanguageCode.En)("nzLabel","\u{1f1fa}\u{1f1f8} "+n.lcZ(13,21,"language.en")),n.xp6(2),n.Q6J("nzValue",a.LanguageCode.Ko)("nzLabel","\u{1f1f0}\u{1f1f7} "+n.lcZ(15,23,"language.ko")),n.xp6(4),n.Oqu(n.lcZ(19,25,"function.name")),n.xp6(2),n.s9C("nzErrorTip",n.lcZ(21,27,"ui.form.should_not_be_empty")),n.xp6(5),n.Oqu(n.lcZ(26,29,"function.description")),n.xp6(3),n.Q6J("nzAutosize",n.DdM(31,tn))}}const P=function(){return[]};let M=(()=>{class o{constructor(t,e,a,s,c,d,A,b,y,F){this.fb=t,this.route=e,this.location=a,this.createFunctionGQL=s,this.updateFunctionGQL=c,this.msgService=d,this.translateService=A,this.languageService=b,this.fileService=y,this.httpClient=F,this.LanguageCode=u.spR,this.FunctionType=u.Cw_,this.destroy$=new V.xQ,this.loading=!1,this.beforeUploadThumbnail=m=>(this.symbolFile=m,this.fileService.getBase64(m,mn=>{this.validateForm.patchValue({symbolUrl:mn})}),!1),this.validateForm=this.fb.group({type:[u.Cw_.Advantage,r.kI.required],symbolUrl:[null,r.kI.required],translations:this.fb.array([],r.kI.required)})}ngOnInit(){this.route.data.pipe((0,L.R)(this.destroy$),(0,I.U)(t=>t.function)).subscribe(t=>{var e;this.function=t,this.validateForm.patchValue({type:t.type,symbolUrl:t.symbolUrl}),this.validateForm.setControl("translations",this.fb.array(this.languageService.sort([...(null===(e=this.function)||void 0===e?void 0:e.translations)||[]]).map(a=>this.fb.group({id:[a.id],name:[a.name,r.kI.required],language:[a.language,r.kI.required],description:[a.description]}))||[],r.kI.required))})}get translations(){return this.validateForm.get("translations")}addTab(){const t=new Set([u.spR.Vi,u.spR.En,u.spR.Ko]);this.translations.controls.forEach(a=>t.delete(a.value.language));const e=0===t.size?u.spR.Vi:t.values().next().value;this.translations.push(this.fb.group({id:[],name:[null,r.kI.required],language:[e,r.kI.required],description:[]}))}removeTab(t){this.translations.removeAt(t)}submit(){var t;if(Object.values(this.validateForm.controls).forEach(a=>{a.markAsDirty(),a.updateValueAndValidity()}),this.validateForm.invalid)return;let e;if(this.loading=!0,this.symbolFile){const a=new FormData;a.append("file",this.symbolFile),e=this.httpClient.post(`${H.N.apiUri}/single-upload?useWatermark=false`,a)}else e=(0,G.of)({url:(null===(t=this.function)||void 0===t?void 0:t.symbolUrl)||""});e.pipe((0,L.R)(this.destroy$),(0,j.zg)(({url:a})=>{var s,c,d,A,b,y;if(null===(s=this.function)||void 0===s?void 0:s.id){const F={type:null===(c=this.validateForm.get("type"))||void 0===c?void 0:c.value,symbolUrl:a,translations:{create:null===(d=this.translations.value)||void 0===d?void 0:d.filter(m=>!m.id).map(m=>Y().omit(m,["id"])),set:null===(A=this.translations.value)||void 0===A?void 0:A.filter(m=>m.id)}};return this.updateFunctionGQL.mutate({where:{id:this.function.id},data:F})}{const F={type:null===(b=this.validateForm.get("type"))||void 0===b?void 0:b.value,symbolUrl:a,translations:{create:null===(y=this.translations.value)||void 0===y?void 0:y.map(m=>Y().omit(m,["id"]))}};return this.createFunctionGQL.mutate({data:F})}})).subscribe(({errors:a,data:s})=>{var c,d;a&&this.msgService.error(this.translateService.instant(`function.${(null===(c=this.function)||void 0===c?void 0:c.id)?"update":"create"}_error`)),s&&(this.msgService.success(this.translateService.instant(`function.${(null===(d=this.function)||void 0===d?void 0:d.id)?"update":"create"}_success`)),this.location.back()),this.loading=!1},()=>{var a;this.msgService.error(this.translateService.instant(`function.${(null===(a=this.function)||void 0===a?void 0:a.id)?"update":"create"}_error`)),this.loading=!1})}cancel(){this.location.back()}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(r.qu),n.Y36(g.gz),n.Y36(h.Ye),n.Y36(u.T8f),n.Y36(u.hV2),n.Y36(D.dD),n.Y36(v.sK),n.Y36(K.T),n.Y36(w.I),n.Y36(O.eN))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-function-details"]],decls:45,vars:39,consts:[[1,"site-page-header"],["nz-page-header-breadcrumb",""],["nz-icon","","nzType","home"],["routerLink","/functions"],["nz-form","",3,"nzLayout","formGroup","ngSubmit"],[1,"mb-3"],["formControlName","type"],[3,"nzLabel","nzValue"],["nzListType","picture-card",1,"cover-uploader",3,"nzBeforeUpload","nzShowUploadList"],[4,"ngIf","ngIfElse"],["elseBlock",""],["nzType","editable-card","formArrayName","translations",3,"nzAdd","nzClose"],["nzClosable","",3,"formGroupName","nzTitle","nzClosable",4,"ngFor","ngForOf"],[1,"mt-2","pb-4"],["nz-button","","nzType","primary",3,"nzLoading"],["nz-button","","type","button",1,"ml-2",3,"nzDanger","click"],["nz-icon","","nzType","camera","nzTheme","outline",1,"upload-icon"],[2,"width","100%",3,"src"],["nzClosable","",3,"formGroupName","nzTitle","nzClosable"],["title",""],["nzHasFeedback","",3,"nzErrorTip"],["formControlName","language"],[3,"nzValue","nzLabel"],["nz-input","","formControlName","name"],["nzHasFeedback",""],["nz-input","","formControlName","description",3,"nzAutosize"]],template:function(t,e){if(1&t&&(n.TgZ(0,"nz-page-header",0),n.TgZ(1,"nz-breadcrumb",1),n.TgZ(2,"nz-breadcrumb-item"),n._UZ(3,"i",2),n.qZA(),n.TgZ(4,"nz-breadcrumb-item"),n.TgZ(5,"a",3),n._uU(6),n.ALo(7,"translate"),n.qZA(),n.qZA(),n.TgZ(8,"nz-breadcrumb-item"),n.TgZ(9,"a"),n._uU(10),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(11,"form",4),n.NdJ("ngSubmit",function(){return e.submit()}),n.TgZ(12,"nz-card",5),n.TgZ(13,"nz-form-item"),n.TgZ(14,"nz-form-label"),n._uU(15),n.ALo(16,"translate"),n.qZA(),n.TgZ(17,"nz-form-control"),n.TgZ(18,"nz-select",6),n._UZ(19,"nz-option",7),n.ALo(20,"translate"),n._UZ(21,"nz-option",7),n.ALo(22,"translate"),n._UZ(23,"nz-option",7),n.ALo(24,"translate"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(25,"nz-form-item"),n.TgZ(26,"nz-form-label"),n._uU(27),n.ALo(28,"translate"),n.qZA(),n.TgZ(29,"nz-form-control"),n.TgZ(30,"nz-upload",8),n.YNc(31,W,2,0,"ng-container",9),n.YNc(32,k,1,1,"ng-template",null,10,n.W1O),n.qZA(),n.qZA(),n.qZA(),n.TgZ(34,"nz-tabset",11),n.NdJ("nzAdd",function(){return e.addTab()})("nzClose",function(s){return e.removeTab(s.index)}),n.YNc(35,en,29,32,"nz-tab",12),n.qZA(),n.qZA(),n.TgZ(36,"nz-form-item",13),n.TgZ(37,"nz-form-control"),n.TgZ(38,"nz-input-group"),n.TgZ(39,"button",14),n._uU(40),n.ALo(41,"translate"),n.qZA(),n.TgZ(42,"button",15),n.NdJ("click",function(){return e.cancel()}),n._uU(43),n.ALo(44,"translate"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&t){const a=n.MAs(33);n.xp6(6),n.Oqu(n.lcZ(7,21,"common.function")),n.xp6(4),n.Oqu(null==((null==e.function?null:e.function.translations)||n.DdM(37,P))[0]?null:((null==e.function?null:e.function.translations)||n.DdM(38,P))[0].name),n.xp6(1),n.Q6J("nzLayout","vertical")("formGroup",e.validateForm),n.xp6(4),n.Oqu(n.lcZ(16,23,"common.type")),n.xp6(4),n.Q6J("nzLabel",n.lcZ(20,25,"function.good"))("nzValue",e.FunctionType.Advantage),n.xp6(2),n.Q6J("nzLabel",n.lcZ(22,27,"function.bad"))("nzValue",e.FunctionType.Disadvantage),n.xp6(2),n.Q6J("nzLabel",n.lcZ(24,29,"function.recommend"))("nzValue",e.FunctionType.Recommendation),n.xp6(4),n.Oqu(n.lcZ(28,31,"function.symbol")),n.xp6(3),n.Q6J("nzBeforeUpload",e.beforeUploadThumbnail)("nzShowUploadList",!1),n.xp6(1),n.Q6J("ngIf",!e.validateForm.controls.symbolUrl.value)("ngIfElse",a),n.xp6(4),n.Q6J("ngForOf",e.translations.controls),n.xp6(4),n.Q6J("nzLoading",e.loading),n.xp6(1),n.hij(" ",n.lcZ(41,33,null!=e.function&&e.function.id?"common.update":"common.add")," "),n.xp6(2),n.Q6J("nzDanger",!0),n.xp6(1),n.hij(" ",n.lcZ(44,35,"common.cancel")," ")}},directives:[f.$O,T.Dg,f.A2,T.MO,N.w,U.Ls,g.yS,r._Y,r.JL,Z.Lr,r.sg,x.bd,R.SK,Z.Nx,R.t3,Z.iK,Z.Fd,q.Vq,r.JJ,r.u,q.Ip,_.FY,h.O5,S.xH,r.CE,h.sg,z.gB,C.ix,$.dQ,S.xw,r.x0,z.Zp,r.Fj,z.rh],pipes:[v.X$,X.o,h.i8],styles:["[_nghost-%COMP%]     .cover-uploader>.ant-upload{overflow:hidden}"]}),o})();function on(o,l){1&o&&(n.TgZ(0,"button",15),n._UZ(1,"i",16),n._uU(2),n.ALo(3,"translate"),n.qZA()),2&o&&(n.xp6(2),n.hij(" ",n.lcZ(3,1,"common.search")," "))}const an=function(o){return["/functions",o]};function rn(o,l){if(1&o&&(n.TgZ(0,"tr"),n.TgZ(1,"td"),n._uU(2),n.qZA(),n.TgZ(3,"td"),n._UZ(4,"img",17),n._uU(5),n.qZA(),n.TgZ(6,"td"),n.TgZ(7,"a",18),n._uU(8),n.ALo(9,"translate"),n.qZA(),n.qZA(),n.qZA()),2&o){const t=l.$implicit;n.xp6(2),n.Oqu(t.id),n.xp6(2),n.Q6J("src",t.symbolUrl,n.LSH)("alt",null==t.translations[0]?null:t.translations[0].name)("title",null==t.translations[0]?null:t.translations[0].name),n.xp6(1),n.hij(" ",null==t.translations[0]?null:t.translations[0].name," "),n.xp6(2),n.Q6J("routerLink",n.VKq(9,an,t.id)),n.xp6(1),n.Oqu(n.lcZ(9,7,"common.edit"))}}let sn=(()=>{class o{constructor(t,e,a,s,c,d){this.fb=t,this.router=e,this.route=a,this.getFunctionListGQL=s,this.msgService=c,this.translateService=d,this.destroy$=new V.xQ,this.functions=[],this.functionsCount=0,this.pageIndex=1,this.pageSize=10,this.loading=!1,this.searchForm=this.fb.group({name:[null]})}ngOnInit(){this.route.queryParamMap.pipe((0,L.R)(this.destroy$)).subscribe(t=>{var e;this.pageIndex=parseInt(t.get("page")||"1",10),this.pageSize=parseInt(t.get("size")||"10",10),this.text=t.get("text")||"",this.patchFormValue(),this.dataSubscription?null===(e=this.dataQueryRef)||void 0===e||e.refetch(this.getVariables()):(this.dataQueryRef=this.getFunctionListGQL.watch(this.getVariables(),{notifyOnNetworkStatusChange:!0,fetchPolicy:"network-only"}),this.dataSubscription=this.dataQueryRef.valueChanges.pipe((0,L.R)(this.destroy$)).subscribe(({data:a,loading:s,error:c,errors:d})=>{if(this.loading=s,!s){if(c||d)return void this.msgService.error(this.translateService.instant("ui.message.can_not_load_data"));a&&(this.functions=a.functions,this.functionsCount=a.functionsConnection.aggregate.count)}}))})}getVariables(){var t;return{first:this.pageSize,skip:(this.pageIndex-1)*this.pageSize,where:{translationsSome:{name:{contains:(null===(t=this.text)||void 0===t?void 0:t.trim())||void 0}}},orderBy:{id:u.d$J.Desc}}}patchFormValue(){this.text&&this.searchForm.controls.name.untouched&&this.searchForm.patchValue({name:this.text})}handleQueryParamsChange(t){this.router.navigate([],{queryParams:{page:t.pageIndex,size:t.pageSize},relativeTo:this.route,queryParamsHandling:"merge"})}handleSearch(){this.router.navigate([],{queryParams:{text:this.searchForm.value.name||void 0,page:1},relativeTo:this.route,queryParamsHandling:"merge"})}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(r.qu),n.Y36(g.F0),n.Y36(g.gz),n.Y36(u.VVc),n.Y36(D.dD),n.Y36(v.sK))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-function-list"]],decls:35,vars:24,consts:[[1,"site-page-header",3,"nzTitle"],["nz-page-header-breadcrumb",""],["nz-icon","","nzType","home"],["nz-button","","nzType","primary","routerLink","/functions/new"],["nz-icon","","nzType","plus","nzTheme","outline"],[1,"mb-3"],["nz-form","",3,"formGroup","ngSubmit"],[1,"row","justify-content-lg-center"],[1,"col-12","col-lg-6"],["nzSearch","",3,"nzAddOnAfter"],["formControlName","name","type","text","nz-input","",3,"placeholder"],["suffixIconButton",""],[1,"mb-4"],["nzBordered","",3,"nzData","nzFrontPagination","nzTotal","nzPageIndex","nzPageSize","nzLoading","nzQueryParams"],[4,"ngFor","ngForOf"],["nz-button","","nzType","primary","type","submit","nzSearch",""],["nz-icon","","nzType","search","nzTheme","outline"],[1,"function__icon","mr-2",3,"src","alt","title"],[3,"routerLink"]],template:function(t,e){if(1&t&&(n.TgZ(0,"nz-page-header",0),n.ALo(1,"translate"),n.TgZ(2,"nz-breadcrumb",1),n.TgZ(3,"nz-breadcrumb-item"),n._UZ(4,"i",2),n.qZA(),n.TgZ(5,"nz-breadcrumb-item"),n.TgZ(6,"a"),n._uU(7),n.ALo(8,"translate"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(9,"nz-page-header-extra"),n.TgZ(10,"button",3),n._UZ(11,"i",4),n._uU(12),n.ALo(13,"translate"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(14,"nz-card",5),n.TgZ(15,"form",6),n.NdJ("ngSubmit",function(){return e.handleSearch()}),n.TgZ(16,"div",7),n.TgZ(17,"div",8),n.TgZ(18,"nz-input-group",9),n._UZ(19,"input",10),n.ALo(20,"translate"),n.qZA(),n.YNc(21,on,4,3,"ng-template",null,11,n.W1O),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(23,"nz-card",12),n.TgZ(24,"nz-table",13),n.NdJ("nzQueryParams",function(s){return e.handleQueryParamsChange(s)}),n.TgZ(25,"thead"),n.TgZ(26,"tr"),n.TgZ(27,"th"),n._uU(28,"ID"),n.qZA(),n.TgZ(29,"th"),n._uU(30),n.ALo(31,"translate"),n.qZA(),n._UZ(32,"th"),n.qZA(),n.qZA(),n.TgZ(33,"tbody"),n.YNc(34,rn,10,11,"tr",14),n.qZA(),n.qZA(),n.qZA()),2&t){const a=n.MAs(22);n.s9C("nzTitle",n.lcZ(1,14,"common.function")),n.xp6(7),n.Oqu(n.lcZ(8,16,"common.function")),n.xp6(5),n.hij(" ",n.lcZ(13,18,"function.create")," "),n.xp6(3),n.Q6J("formGroup",e.searchForm),n.xp6(3),n.Q6J("nzAddOnAfter",a),n.xp6(1),n.s9C("placeholder",n.lcZ(20,20,"function.name")),n.xp6(5),n.Q6J("nzData",e.functions)("nzFrontPagination",!1)("nzTotal",e.functionsCount)("nzPageIndex",e.pageIndex)("nzPageSize",e.pageSize)("nzLoading",e.loading),n.xp6(6),n.Oqu(n.lcZ(31,22,"function.name")),n.xp6(4),n.Q6J("ngForOf",e.functions)}},directives:[f.$O,T.Dg,f.A2,T.MO,N.w,U.Ls,f.Jp,C.ix,$.dQ,g.rH,x.bd,r._Y,r.JL,Z.Lr,r.sg,z.gB,r.Fj,z.Zp,r.JJ,r.u,p.N8,p.Om,p.$Z,p.Uo,p._C,p.p0,h.sg,g.yS],pipes:[v.X$],styles:[".function__icon[_ngcontent-%COMP%]{width:40px;height:40px}"]}),o})(),Q=(()=>{class o{constructor(t,e){this.getFunctionDetailsGQL=t,this.router=e}resolve(t){const e=parseInt(t.paramMap.get("id")||"",10);return e?this.getFunctionDetailsGQL.fetch({where:{id:e}},{fetchPolicy:"network-only"}).pipe((0,I.U)(a=>{var s;if(!a.error&&!a.errors)return(null===(s=a.data)||void 0===s?void 0:s.function)?a.data.function:void this.router.navigateByUrl("/exception/404");this.router.navigateByUrl("/exception/500")})):{translations:[{language:u.spR.Vi}]}}}return o.\u0275fac=function(t){return new(t||o)(n.LFG(u.wEw),n.LFG(g.F0))},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac}),o})();const ln=[{path:"new",resolve:{function:Q},component:M},{path:":id",resolve:{function:Q},component:M},{path:"",pathMatch:"full",component:sn}];let un=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[[g.Bz.forChild(ln)],g.Bz]}),o})();var cn=i(7615);let dn=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({providers:[Q],imports:[[h.ez,un,r.u5,r.UX,cn.m,v.aw.forChild(),f.KJ,T.lt,C.sL,U.PV,z.o7,x.vh,p.HQ,D.gR,B.wm,Z.U5,q.LV,_.cS,O.JF,S.we]]}),o})()}}]);