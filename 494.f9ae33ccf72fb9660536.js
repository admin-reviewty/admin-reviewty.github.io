"use strict";(self.webpackChunkadmin_angular=self.webpackChunkadmin_angular||[]).push([[494],{5329:(te,Pt,a)=>{a.d(Pt,{Dz:()=>U,Rt:()=>Y});var Tt=a(4762),A=a(521),s=a(7716),S=a(2729),v=a(6182),At=a(946),J=a(8583),St=a(464);const It=["textEl"];function $(m,b){if(1&m&&s._UZ(0,"i",3),2&m){const p=s.oxw();s.Q6J("nzType",p.nzIcon)}}function X(m,b){if(1&m){const p=s.EpF();s.TgZ(0,"img",4),s.NdJ("error",function(q){return s.CHM(p),s.oxw().imgError(q)}),s.qZA()}if(2&m){const p=s.oxw();s.Q6J("src",p.nzSrc,s.LSH),s.uIk("srcset",p.nzSrcSet,s.LSH)("alt",p.nzAlt)}}function k(m,b){if(1&m&&(s.TgZ(0,"span",5,6),s._uU(2),s.qZA()),2&m){const p=s.oxw();s.Q6J("ngStyle",p.textStyles),s.xp6(2),s.Oqu(p.nzText)}}let U=(()=>{class m{constructor(p,h,q,B){this.nzConfigService=p,this.elementRef=h,this.cdr=q,this.platform=B,this._nzModuleName="avatar",this.nzShape="circle",this.nzSize="default",this.nzGap=4,this.nzError=new s.vpe,this.hasText=!1,this.hasSrc=!0,this.hasIcon=!1,this.textStyles={},this.classMap={},this.customSize=null,this.el=this.elementRef.nativeElement,this.elementRef.nativeElement.classList.add("ant-avatar")}imgError(p){this.nzError.emit(p),p.defaultPrevented||(this.hasSrc=!1,this.hasIcon=!1,this.hasText=!1,this.nzIcon?this.hasIcon=!0:this.nzText&&(this.hasText=!0),this.cdr.detectChanges(),this.setSizeStyle(),this.notifyCalc())}ngOnChanges(){this.hasText=!this.nzSrc&&!!this.nzText,this.hasIcon=!this.nzSrc&&!!this.nzIcon,this.hasSrc=!!this.nzSrc,this.setSizeStyle(),this.notifyCalc()}calcStringSize(){if(!this.hasText)return;const p=this.textEl.nativeElement.offsetWidth,h=this.el.getBoundingClientRect().width,q=2*this.nzGap<h?2*this.nzGap:8;this.textStyles={transform:`scale(${h-q<p?(h-q)/p:1}) translateX(-50%)`},this.customSize&&Object.assign(this.textStyles,{lineHeight:this.customSize}),this.cdr.detectChanges()}notifyCalc(){this.platform.isBrowser&&setTimeout(()=>{this.calcStringSize()})}setSizeStyle(){this.customSize="number"==typeof this.nzSize?`${this.nzSize}px`:null,this.cdr.markForCheck()}}return m.\u0275fac=function(p){return new(p||m)(s.Y36(S.jY),s.Y36(s.SBq),s.Y36(s.sBO),s.Y36(A.t4))},m.\u0275cmp=s.Xpm({type:m,selectors:[["nz-avatar"]],viewQuery:function(p,h){if(1&p&&s.Gf(It,5),2&p){let q;s.iGM(q=s.CRH())&&(h.textEl=q.first)}},hostVars:20,hostBindings:function(p,h){2&p&&(s.Udp("width",h.customSize)("height",h.customSize)("line-height",h.customSize)("font-size",h.hasIcon&&h.customSize?h.nzSize/2:null,"px"),s.ekj("ant-avatar-lg","large"===h.nzSize)("ant-avatar-sm","small"===h.nzSize)("ant-avatar-square","square"===h.nzShape)("ant-avatar-circle","circle"===h.nzShape)("ant-avatar-icon",h.nzIcon)("ant-avatar-image",h.hasSrc))},inputs:{nzShape:"nzShape",nzSize:"nzSize",nzGap:"nzGap",nzText:"nzText",nzSrc:"nzSrc",nzSrcSet:"nzSrcSet",nzAlt:"nzAlt",nzIcon:"nzIcon"},outputs:{nzError:"nzError"},exportAs:["nzAvatar"],features:[s.TTD],decls:3,vars:3,consts:[["nz-icon","",3,"nzType",4,"ngIf"],[3,"src","error",4,"ngIf"],["class","ant-avatar-string",3,"ngStyle",4,"ngIf"],["nz-icon","",3,"nzType"],[3,"src","error"],[1,"ant-avatar-string",3,"ngStyle"],["textEl",""]],template:function(p,h){1&p&&(s.YNc(0,$,1,1,"i",0),s.YNc(1,X,1,3,"img",1),s.YNc(2,k,3,2,"span",2)),2&p&&(s.Q6J("ngIf",h.nzIcon&&h.hasIcon),s.xp6(1),s.Q6J("ngIf",h.nzSrc&&h.hasSrc),s.xp6(1),s.Q6J("ngIf",h.nzText&&h.hasText))},directives:[J.O5,St.Ls,J.PC],encapsulation:2,changeDetection:0}),(0,Tt.gn)([(0,S.oS)()],m.prototype,"nzShape",void 0),(0,Tt.gn)([(0,S.oS)()],m.prototype,"nzSize",void 0),(0,Tt.gn)([(0,S.oS)(),(0,v.Rn)()],m.prototype,"nzGap",void 0),m})(),Y=(()=>{class m{}return m.\u0275fac=function(p){return new(p||m)},m.\u0275mod=s.oAB({type:m}),m.\u0275inj=s.cJS({imports:[[At.vT,J.ez,St.PV,A.ud]]}),m})()},494:(te,Pt,a)=>{a.r(Pt),a.d(Pt,{ProductModule:()=>hn});var Tt=a(1841),A=a(8583),s=a(6271),S=a(5392),v=a(6795),At=a(7018),J=a(8058),St=a(3845),It=a(2677),$=a(4453),X=a(464),k=a(5887),E=a(6704),Ut=a(352),U=a(7674),Mt=a(343),Y=a(269),m=a(3479),b=a(4788),p=a(2079),h=a(8453),q=a(6640),B=a(7420),Lt=a(1398),$t=a(5329),P=a(9790),g=a(3679),ee=a(8542),bt=a(5072),Qt=a(3721),Q=a(5987),Ct=a(9765),ne=a(9112),ie=a(5917),C=a(6782),oe=a(9773),re=a(3815),ae=a.n(re),Xt=a(2340),z=a(7071),t=a(7716),Ot=a(4514),Dt=a(9374);function le(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td",12),t.NdJ("nzCheckedChange",function(o){return t.CHM(e).$implicit.checked=o})("nzCheckedChange",function(){return t.CHM(e),t.oxw().refreshStatus()}),t.qZA(),t.TgZ(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td",8),t._uU(7),t.qZA(),t.TgZ(8,"td",8),t._uU(9),t.qZA(),t.qZA()}if(2&i){const e=l.$implicit;t.xp6(1),t.Q6J("nzLeft",!0)("nzChecked",e.checked)("nzDisabled",e.disabled),t.xp6(2),t.hij(" ",null==e?null:e.source," "),t.xp6(2),t.hij(" ",null==e?null:e.target," "),t.xp6(1),t.Q6J("nzLeft",!0),t.xp6(1),t.Oqu(null==e?null:e.id),t.xp6(1),t.Q6J("nzLeft",!0),t.xp6(1),t.Oqu(null==e?null:e.ewg)}}const se=function(){return{minRows:5,maxRows:10}},de=function(){return[]},ue=/(.+?)[\r\n]+.*?[\r\n]?\t(.*?)\t(.*?)\t(.*?)\t(.*)/g,ce=/(\d?)[\r\n]+\t(.*?)[\r\n]+\t(.*?)[\r\n]+/g;var V=(()=>{return(i=V||(V={}))[i.COSDNA=1]="COSDNA",i[i.SKINCARISMA=2]="SKINCARISMA",i[i.OTHER=3]="OTHER",V;var i})();let ge=(()=>{class i{constructor(e,n,o,r){this.analyzeIngredientsGQL=e,this.msgService=n,this.translateService=o,this.drawerRef=r,this.IngredientSource=V,this.allChecked=!0,this.selectedIngredients=new Set,this.destroy$=new Ct.xQ}ngOnInit(){!this.analyzedResult||!this.selectedIngredients||(this.analyzedResult=this.analyzedResult.map(e=>(e.checked=this.selectedIngredients.has(e.id||0),e.disabled=this.selectedIngredients.has(e.id||0)||!e.id,e)))}analyzeIngredients(e){if(this.analyzing=e,!this.searchText)return void(this.analyzing=void 0);let n;const o=[];if(e!==V.OTHER){const r=e===V.COSDNA?ue:ce;let d;for(;d=r.exec(this.searchText),d;)o.push(d[e===V.COSDNA?1:3]);n=o.join(";")}else n=this.searchText,o.push(...n.split(";"));this.analyzeIngredientsGQL.watch({text:n},{notifyOnNetworkStatusChange:!0,errorPolicy:"all"}).valueChanges.pipe((0,C.R)(this.destroy$)).subscribe(({data:r,loading:d,errors:u,error:_})=>{if(this.analyzing=d&&e||void 0,!d){if(_||u)return void this.msgService.error(this.translateService.instant("ui.message.error"));r&&(this.analyzedResult=r.analyzeIngredients.ingredients.map((c,f)=>{var Z;return{id:null==c?void 0:c.id,source:o[f],target:null===(Z=null==c?void 0:c.translations)||void 0===Z?void 0:Z[0].name,ewg:(null==c?void 0:c.ewg)||void 0,checked:!!c,disabled:!c||this.selectedIngredients.has(c.id)}}))}})}checkAllIngredients(e){var n;null===(n=this.analyzedResult)||void 0===n||n.forEach(o=>{o.id&&(o.checked=e)}),this.refreshStatus()}refreshStatus(){var e;const n=(null===(e=this.analyzedResult)||void 0===e?void 0:e.filter(o=>!!o.id))||[];this.allChecked=n.length>0&&n.every(o=>!0===o.checked)}pickAnalyzedIngredients(){var e;!(null===(e=this.analyzedResult)||void 0===e?void 0:e.length)||this.drawerRef.close(this.backupData(!1))}cancel(){this.drawerRef.close(this.backupData(!0))}backupData(e){var n;return{allChecked:this.allChecked,searchText:this.searchText,analyzedResult:this.analyzedResult,newSelectedIngredients:e?[]:null===(n=this.analyzedResult)||void 0===n?void 0:n.filter(o=>o.checked&&!o.disabled)}}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(z.LVj),t.Y36(J.dD),t.Y36(P.sK),t.Y36(Qt.lB))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-ingredient-analysis"]],decls:35,vars:24,consts:[[1,"mb-2"],["nz-input","",3,"nzAutosize","ngModel","ngModelChange"],["nz-button","","nzType","dashed","type","button",1,"mr-2",3,"nzLoading","click"],["nz-icon","","nzType","search","nzTheme","outline"],["nz-button","","nzType","dashed","type","button",3,"nzLoading","click"],[3,"nzData","hidden","nzPageSize"],["table",""],["nzWidth","60px",3,"nzLeft","nzChecked","nzCheckedChange"],[3,"nzLeft"],[4,"ngFor","ngForOf"],["nz-button","",1,"mr-2",3,"click"],["nz-button","","type","button","nzType","primary",3,"click"],[3,"nzLeft","nzChecked","nzDisabled","nzCheckedChange"]],template:function(e,n){if(1&e&&(t.TgZ(0,"nz-form-control",0),t.TgZ(1,"textarea",1),t.NdJ("ngModelChange",function(r){return n.searchText=r}),t.qZA(),t.qZA(),t.TgZ(2,"nz-input-group",0),t.TgZ(3,"button",2),t.NdJ("click",function(){return n.analyzeIngredients(n.IngredientSource.COSDNA)}),t._UZ(4,"i",3),t._uU(5,"CosDNA "),t.qZA(),t.TgZ(6,"button",2),t.NdJ("click",function(){return n.analyzeIngredients(n.IngredientSource.SKINCARISMA)}),t._UZ(7,"i",3),t._uU(8,"Skincarisma "),t.qZA(),t.TgZ(9,"button",4),t.NdJ("click",function(){return n.analyzeIngredients(n.IngredientSource.OTHER)}),t._UZ(10,"i",3),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.qZA(),t.TgZ(13,"nz-table",5,6),t.TgZ(15,"thead"),t.TgZ(16,"tr"),t.TgZ(17,"th",7),t.NdJ("nzCheckedChange",function(r){return n.checkAllIngredients(r)})("nzCheckedChange",function(r){return n.allChecked=r}),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Source"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"Target"),t.qZA(),t.TgZ(22,"th",8),t._uU(23,"ID"),t.qZA(),t.TgZ(24,"th",8),t._uU(25,"EWG"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(26,"tbody"),t.YNc(27,le,10,9,"tr",9),t.qZA(),t.qZA(),t.TgZ(28,"div"),t.TgZ(29,"button",10),t.NdJ("click",function(){return n.cancel()}),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"button",11),t.NdJ("click",function(){return n.pickAnalyzedIngredients()}),t._uU(33),t.ALo(34,"translate"),t.qZA(),t.qZA()),2&e){const o=t.MAs(14);t.xp6(1),t.Q6J("nzAutosize",t.DdM(22,se))("ngModel",n.searchText),t.xp6(2),t.Q6J("nzLoading",n.analyzing===n.IngredientSource.COSDNA),t.xp6(3),t.Q6J("nzLoading",n.analyzing===n.IngredientSource.SKINCARISMA),t.xp6(3),t.Q6J("nzLoading",n.analyzing===n.IngredientSource.OTHER),t.xp6(2),t.hij("",t.lcZ(12,16,"common.other")," "),t.xp6(2),t.Q6J("nzData",n.analyzedResult||t.DdM(23,de))("hidden",!n.analyzedResult)("nzPageSize",10),t.xp6(4),t.Q6J("nzLeft",!0)("nzChecked",n.allChecked),t.xp6(5),t.Q6J("nzLeft",!0),t.xp6(2),t.Q6J("nzLeft",!0),t.xp6(3),t.Q6J("ngForOf",o.data),t.xp6(3),t.hij(" ",t.lcZ(31,18,"common.cancel")," "),t.xp6(3),t.hij(" ",t.lcZ(34,20,"product.import_ingredients")," ")}},directives:[E.t3,k.Fd,U.Zp,U.rh,g.Fj,g.JJ,g.On,Ot.w,U.gB,$.ix,Dt.dQ,X.Ls,v.N8,v.Om,v.$Z,v.Uo,v._C,v.qn,v.g6,v.p0,A.sg,v.h7],pipes:[P.X$],styles:[""]}),i})();var pe=a(2250),me=a(9665),he=a(4701),_e=a(5021),Yt=a(6215),Bt=a(4395),Vt=a(7519),Gt=a(5435),jt=a(3342);function ve(i,l){if(1&i&&(t.ynx(0),t._UZ(1,"nz-option",3),t.BQk()),2&i){const e=l.$implicit;t.xp6(1),t.Q6J("nzValue",e)("nzLabel",e.name)}}function ze(i,l){1&i&&(t.TgZ(0,"nz-option",4),t._UZ(1,"i",5),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&i&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"ui.select.loading_data")," "))}let Ht=(()=>{class i{constructor(e){this.searchBrandsGQL=e,this.destroy$=new Ct.xQ,this.translation=void 0,this.loading=!1,this.text$=new Yt.X(""),this.buffer=[],this.onChange=n=>{},this.onTouched=()=>{},this.text$.pipe((0,C.R)(this.destroy$),(0,Bt.b)(250),(0,Vt.x)(),(0,Gt.h)(n=>(null==n?void 0:n.trim().length)>0),(0,jt.b)(()=>{this.buffer=[],this.fetchMore()})).subscribe()}ngOnInit(){}writeValue(e){this.translation!==e&&(this.translation=e,this.handleModelChange(),!this.buffer.length&&e&&this.buffer.push(e))}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}handleModelChange(){this.onChange(this.translation)}handleSearch(e){this.text$.next(e)}fetchMore(){var e,n;this.dataSubscription?null===(e=this.dataQueryRef)||void 0===e||e.refetch(this.getVariables()):(this.dataQueryRef=this.searchBrandsGQL.watch(this.getVariables(),{notifyOnNetworkStatusChange:!0}),this.dataSubscription=null===(n=this.dataQueryRef)||void 0===n?void 0:n.valueChanges.pipe((0,C.R)(this.destroy$)).subscribe(({loading:o,data:r})=>{var d;this.loading=o,!o&&(this.buffer=this.buffer.concat(null===(d=r.brands)||void 0===d?void 0:d.filter(u=>{var _;return(null===(_=u.translations)||void 0===_?void 0:_.length)>0}).map(u=>{var _,c;return{name:null===(c=null===(_=u.translations)||void 0===_?void 0:_[0])||void 0===c?void 0:c.name,brand:{id:u.id}}})))}))}getVariables(){return{where:{translationsSome:{nameContains:this.text$.getValue()}},first:30,skip:this.buffer.length,orderBy:{id:z.d$J.Desc}}}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(z.C1p))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-brand-select"]],features:[t._Bn([{provide:g.JU,useExisting:(0,t.Gpc)(()=>i),multi:!0}])],decls:4,vars:7,consts:[["nzAllowClear","","nzShowSearch","","nzServerSearch","",1,"w-100",3,"ngModel","nzAutoClearSearchValue","nzPlaceHolder","ngModelChange","nzOnSearch","nzScrollToBottom"],[4,"ngFor","ngForOf"],["nzDisabled","","nzCustomContent","",4,"ngIf"],[3,"nzValue","nzLabel"],["nzDisabled","","nzCustomContent",""],["nz-icon","","nzType","loading",1,"loading-icon"]],template:function(e,n){1&e&&(t.TgZ(0,"nz-select",0),t.NdJ("ngModelChange",function(r){return n.translation=r})("nzOnSearch",function(r){return n.handleSearch(r)})("nzScrollToBottom",function(){return n.fetchMore()})("ngModelChange",function(){return n.handleModelChange()}),t.ALo(1,"translate"),t.YNc(2,ve,2,2,"ng-container",1),t.YNc(3,ze,4,3,"nz-option",2),t.qZA()),2&e&&(t.s9C("nzPlaceHolder",t.lcZ(1,5,"common.brand")),t.Q6J("ngModel",n.translation)("nzAutoClearSearchValue",!1),t.xp6(2),t.Q6J("ngForOf",n.buffer),t.xp6(1),t.Q6J("ngIf",n.loading))},directives:[Y.Vq,g.JJ,g.On,A.sg,A.O5,Y.Ip],pipes:[P.X$],styles:[""]}),i})(),fe=(()=>{class i{constructor(e){this.searchIngredientTranslationsGQL=e,this.destroy$=new Ct.xQ,this.translations=void 0,this.loading=!1,this.text$=new Yt.X(""),this.buffer=[],this.completed=!1,this.onChange=n=>{},this.onTouched=()=>{},this.text$.pipe((0,C.R)(this.destroy$),(0,Bt.b)(250),(0,Vt.x)(),(0,Gt.h)(n=>(null==n?void 0:n.trim().length)>0),(0,jt.b)(()=>{this.buffer=[],this.fetchMore()})).subscribe()}writeValue(e){this.translations!==e&&(this.translations=e,this.handleModelChange(),this.buffer.push(...e||[]))}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}handleModelChange(){this.onChange(this.translations)}ngOnInit(){}scrollToEnd(){}scroll({end:e}){this.loading||this.completed||!this.text$.getValue()||e+10>=this.buffer.length&&this.fetchMore()}handleSearch(e){0===(null==e?void 0:e.trim().length)&&(this.buffer=[]),this.text$.next(e)}fetchMore(){var e,n;this.dataSubscription?null===(e=this.dataQueryRef)||void 0===e||e.refetch({where:{nameContains:this.text$.getValue()},first:30,skip:this.buffer.length,orderBy:{id:z.d$J.Asc}}):(this.dataQueryRef=this.searchIngredientTranslationsGQL.watch({where:{nameContains:this.text$.getValue()},first:30,orderBy:{id:z.d$J.Asc}},{notifyOnNetworkStatusChange:!0}),this.dataSubscription=null===(n=this.dataQueryRef)||void 0===n?void 0:n.valueChanges.pipe((0,C.R)(this.destroy$)).subscribe(({loading:o,data:r})=>{this.loading=o,!o&&(this.completed=0===(null==r?void 0:r.ingredientTranslations.length),this.buffer=this.buffer.concat(...r.ingredientTranslations))}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(z.a_5))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-ingredient-select"]],features:[t._Bn([{provide:g.JU,useExisting:(0,t.Gpc)(()=>i),multi:!0}])],decls:2,vars:10,consts:[["bindLabel","name",3,"items","virtualScroll","loading","hideSelected","typeahead","ngModel","multiple","placeholder","ngModelChange","scroll","scrollToEnd"]],template:function(e,n){1&e&&(t.TgZ(0,"ng-select",0),t.NdJ("ngModelChange",function(r){return n.translations=r})("scroll",function(r){return n.scroll(r)})("scrollToEnd",function(){return n.scrollToEnd()})("ngModelChange",function(){return n.handleModelChange()}),t.ALo(1,"translate"),t.qZA()),2&e&&(t.s9C("placeholder",t.lcZ(1,8,"ingredient.name")),t.Q6J("items",n.buffer)("virtualScroll",!0)("loading",n.loading)("hideSelected",!0)("typeahead",n.text$)("ngModel",n.translations)("multiple",!0))},directives:[q.w9,g.JJ,g.On],pipes:[P.X$],styles:[""]}),i})();var Jt=a(5350);function Ze(i,l){if(1&i&&t._UZ(0,"nz-option",50),2&i){const e=l.$implicit;t.Q6J("nzValue",e)("nzLabel",e)}}function Te(i,l){if(1&i&&(t.TgZ(0,"nz-select",48),t.YNc(1,Ze,1,2,"nz-option",49),t.qZA()),2&i){const e=t.oxw();t.Q6J("nzAllowClear",!0),t.xp6(1),t.Q6J("ngForOf",e.packagingUnits)}}function Ae(i,l){if(1&i&&t._UZ(0,"nz-option",50),2&i){const e=l.$implicit;t.Q6J("nzValue",e)("nzLabel",e)}}function be(i,l){if(1&i&&(t.TgZ(0,"nz-select",51),t.YNc(1,Ae,1,2,"nz-option",49),t.qZA()),2&i){const e=t.oxw();t.Q6J("nzAllowClear",!0),t.xp6(1),t.Q6J("ngForOf",e.units)}}function Ce(i,l){if(1&i&&t._UZ(0,"nz-option",50),2&i){const e=l.$implicit;t.Q6J("nzValue",e)("nzLabel",e)}}function ye(i,l){if(1&i&&(t.TgZ(0,"nz-select",52),t.YNc(1,Ce,1,2,"nz-option",49),t.qZA()),2&i){const e=t.oxw();t.Q6J("nzAllowClear",!0),t.xp6(1),t.Q6J("ngForOf",e.units)}}function xe(i,l){if(1&i&&t._UZ(0,"nz-option",50),2&i){const e=l.$implicit;t.Q6J("nzValue",e)("nzLabel",e)}}function qe(i,l){if(1&i&&(t.TgZ(0,"nz-select",53),t.YNc(1,xe,1,2,"nz-option",49),t.qZA()),2&i){const e=t.oxw();t.Q6J("nzAllowClear",!0),t.xp6(1),t.Q6J("ngForOf",e.units)}}function Se(i,l){1&i&&(t.ynx(0),t._UZ(1,"i",54),t.BQk())}const kt=function(){return[]};function Ie(i,l){if(1&i&&t._UZ(0,"img",55),2&i){const e=t.oxw();t.Q6J("src",e.thumbnailFile?null==e.thumbnailImage?null:e.thumbnailImage.url:(null==e.product||null==e.product.thumbnail||null==e.product.thumbnail.small?null:e.product.thumbnail.small.url)||"",t.LSH)("appImgFallback",(null==e.product||null==e.product.thumbnail?null:e.product.thumbnail.url)||t.DdM(2,kt))}}function Ue(i,l){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",56),t.NdJ("click",function(){return t.CHM(e),t.oxw().addVideo()}),t._UZ(2,"i",57),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.BQk()}2&i&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"product.add_video")," "))}function Pe(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"button",58),t.NdJ("click",function(){return t.CHM(e),t.oxw().removeVideo()}),t._UZ(1,"i",59),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&i&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"product.remove_video")," "))}function Le(i,l){1&i&&(t.TgZ(0,"div",12),t.TgZ(1,"div",13),t.TgZ(2,"nz-form-item"),t.TgZ(3,"nz-form-label"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"nz-form-control"),t._UZ(7,"input",60),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"div",13),t.TgZ(9,"nz-form-item"),t.TgZ(10,"nz-form-label"),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"nz-form-control"),t._UZ(14,"input",61),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&i&&(t.Q6J("nzGutter",16),t.xp6(1),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",12)("nzXl",12)("nzXXl",12),t.xp6(3),t.Oqu(t.lcZ(5,15,"product.video_title")),t.xp6(4),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",12)("nzXl",12)("nzXXl",12),t.xp6(3),t.Oqu(t.lcZ(12,17,"product.video_url")))}function Oe(i,l){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",56),t.NdJ("click",function(){return t.CHM(e),t.oxw().addImageDescription()}),t._UZ(2,"i",57),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.BQk()}2&i&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"product.add_image_description")," "))}function De(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"button",58),t.NdJ("click",function(){return t.CHM(e),t.oxw().removeImageDescription()}),t._UZ(1,"i",59),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&i&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"product.remove_image_description")," "))}const ke=function(){return["print preview fullpage paste importcss searchreplace autolink autosave save directionality code visualblocks","visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc","insertdatetime advlist lists wordcount imagetools textpattern noneditable help charmap quickbars emoticons"]},Ne=function(i,l){return{height:500,menubar:!0,images_upload_handler:i,plugins:l,toolbar:"undo redo | bold italic underline strikethrough | \n      fontselect fontsizeselect formatselect | \n      alignleft aligncenter alignright alignjustify | \n      outdent indent |  numlist bullist checklist | \n      forecolor backcolor casechange permanentpen formatpainter removeformat | \n      pagebreak | charmap emoticons | fullscreen  preview save print | \n      insertfile image media pageembed template link anchor codesample | a11ycheck ltr rtl | showcomments addcomment"}};function we(i,l){if(1&i&&(t.TgZ(0,"nz-form-item"),t.TgZ(1,"nz-form-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"nz-form-control"),t._UZ(5,"editor",62),t.qZA(),t.qZA()),2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"product.image_description")),t.xp6(3),t.Q6J("init",t.WLB(5,Ne,e.handleUploadImage,t.DdM(4,ke)))}}function Re(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"i",63),t.NdJ("click",function(){return t.CHM(e),t.oxw().generateSlug()}),t.ALo(1,"translate"),t.qZA()}2&i&&t.Q6J("nzTooltipTitle",t.lcZ(1,1,"product.create_slug_from_name"))}function Ee(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"button",64),t.NdJ("click",function(){return t.CHM(e),t.oxw().addIngredients()}),t._UZ(1,"i",65),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&i&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"product.import_ingredients")," "))}function $e(i,l){if(1&i&&t._UZ(0,"nz-option",50),2&i){const e=l.$implicit;t.Q6J("nzValue",e)("nzLabel",e)}}function Xe(i,l){if(1&i&&(t.TgZ(0,"nz-select",71),t.YNc(1,$e,1,2,"nz-option",49),t.qZA()),2&i){const e=t.oxw(2);t.Q6J("nzAllowClear",!0),t.xp6(1),t.Q6J("ngForOf",e.units)}}function Ye(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"tr",66),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t.TgZ(6,"nz-input-group",17),t._UZ(7,"nz-input-number",67),t.qZA(),t.YNc(8,Xe,2,2,"ng-template",null,68,t.W1O),t.qZA(),t.TgZ(10,"td"),t.TgZ(11,"button",69),t.NdJ("click",function(){const r=t.CHM(e).index;return t.oxw().removeIngredient(r)}),t._UZ(12,"i",70),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=l.$implicit,n=l.index,o=t.MAs(9);t.oxw();const r=t.MAs(158);t.Q6J("formGroupName",(r.nzPageIndex-1)*r.nzPageSize+n),t.xp6(2),t.Oqu(e.value.id),t.xp6(2),t.Oqu(e.value.name),t.xp6(2),t.Q6J("nzAddOnAfter",o)}}const Be=function(){return{minRows:10,maxRows:10}},Ve=function(){return{"max-height":"300px"}},Ge=function(){return{standalone:!0}};let Wt=(()=>{class i{constructor(e,n,o,r,d,u,_,c,f,Z,L,F,N,w,R){this.fb=e,this.route=n,this.getHierarchicalCategoriesGQL=o,this.httpClient=r,this.location=d,this.fileService=u,this.createProductGQL=_,this.updateProductGQL=c,this.msgService=f,this.translateService=Z,this.stringService=L,this.languageService=F,this.breakpointObserver=N,this.drawerService=w,this.unitConverter=R,this.ProductStatus=z.Pte,this.units=[...Object.values(z.fbc),"IU"],this.packagingUnits=Object.values(z.ITi),this.loading=!1,this.selectedIngredients=[],this.categories=[],this.formatterVnd=x=>`\u20ab ${x}`,this.beforeUploadThumbnail=x=>(this.thumbnailFile=x,this.fileService.getBase64(x,(O,D,I)=>{var y;this.thumbnailImage={url:O,name:(null===(y=this.thumbnailFile)||void 0===y?void 0:y.filename)||"",width:D,height:I}}),!1),this.handleUploadImage=(x,O,D)=>{const I=new FormData;I.append("file",x.blob()),this.httpClient.post(`${Xt.N.apiUri}/single-upload?useWatermark=false`,I).subscribe(y=>{O(y.url)},y=>{D(y)})},this.destroy$=new Ct.xQ,this.validateForm=this.fb.group({name:[null,g.kI.required],description:[null,g.kI.required],slug:[null,g.kI.required],price:[null,g.kI.required],measure:[null,g.kI.required],status:[!0,g.kI.required],categories:[[],g.kI.required],brand:[null,g.kI.required],ingredients:this.fb.array([]),barcodes:[[]],rdi:[null],packagingUnit:[null],netWeightPerPackage:[null],weightUnit:[null],netVolumePerPackage:[null],volumeUnit:[null],energyPerPackage:[null],energyUnit:[null]}),this.languages=new Map,this.languages.set(z.spR.Vi,1),this.languages.set(z.spR.En,2)}ngOnInit(){(0,ne.aj)([this.route.data,this.unitConverter.fetchConfig()]).pipe((0,C.R)(this.destroy$)).subscribe(([{product:e}])=>{var n,o,r,d,u,_,c,f,Z,L,F,N,w,R,x,O,D,I,y,G,j,H,W,K,tt,et,nt,it,ot,rt,at,lt,st,dt,ut,ct,gt,pt,mt,ht,_t,vt,zt,ft,Zt,yt,xt,T,M,Ft,Nt;this.product=e,this.thumbnailImage=(null===(n=this.product)||void 0===n?void 0:n.thumbnail)&&{url:this.product.thumbnail.url,name:this.product.thumbnail.name,width:this.product.thumbnail.width||0,height:this.product.thumbnail.height||0}||void 0,((null===(o=this.product)||void 0===o?void 0:o.videoTitle)||(null===(r=this.product)||void 0===r?void 0:r.videoUrl))&&this.addVideo(),(null===(d=this.product)||void 0===d?void 0:d.id)&&(null===(c=null===(_=null===(u=this.product)||void 0===u?void 0:u.translations)||void 0===_?void 0:_[0])||void 0===c?void 0:c.imageDescription)&&this.addImageDescription(),this.validateForm.patchValue({name:null===(L=null===(Z=null===(f=this.product)||void 0===f?void 0:f.translations)||void 0===Z?void 0:Z[0])||void 0===L?void 0:L.name,description:null===(w=null===(N=null===(F=this.product)||void 0===F?void 0:F.translations)||void 0===N?void 0:N[0])||void 0===w?void 0:w.description,imageDescription:null===(O=null===(x=null===(R=this.product)||void 0===R?void 0:R.translations)||void 0===x?void 0:x[0])||void 0===O?void 0:O.imageDescription,slug:null===(y=null===(I=null===(D=this.product)||void 0===D?void 0:D.translations)||void 0===I?void 0:I[0])||void 0===y?void 0:y.slug,price:(null===(G=this.product)||void 0===G?void 0:G.price)||"",measure:null===(j=this.product)||void 0===j?void 0:j.measure,status:(null===(H=this.product)||void 0===H?void 0:H.status)===z.Pte.Active,videoUrl:null===(W=this.product)||void 0===W?void 0:W.videoUrl,videoTitle:null===(K=this.product)||void 0===K?void 0:K.videoTitle,packagingUnit:null===(et=null===(tt=this.product)||void 0===tt?void 0:tt.attributes)||void 0===et?void 0:et.packagingUnit,rdi:null===(it=null===(nt=this.product)||void 0===nt?void 0:nt.attributes)||void 0===it?void 0:it.rdi,netWeightPerPackage:null===(rt=null===(ot=this.product)||void 0===ot?void 0:ot.attributes)||void 0===rt?void 0:rt.netWeightPerPackage,weightUnit:null===(lt=null===(at=this.product)||void 0===at?void 0:at.attributes)||void 0===lt?void 0:lt.weightUnit,netVolumePerPackage:null===(dt=null===(st=this.product)||void 0===st?void 0:st.attributes)||void 0===dt?void 0:dt.netVolumePerPackage,volumeUnit:null===(ct=null===(ut=this.product)||void 0===ut?void 0:ut.attributes)||void 0===ct?void 0:ct.volumeUnit,energyPerPackage:null===(pt=null===(gt=this.product)||void 0===gt?void 0:gt.attributes)||void 0===pt?void 0:pt.energyPerPackage,energyUnit:null===(ht=null===(mt=this.product)||void 0===mt?void 0:mt.attributes)||void 0===ht?void 0:ht.energyUnit,categories:(null===(vt=null===(_t=this.product)||void 0===_t?void 0:_t.categories)||void 0===vt?void 0:vt.map(qt=>`${qt.id}`))||[],brand:{name:null===(yt=null===(Zt=null===(ft=null===(zt=this.product)||void 0===zt?void 0:zt.brand)||void 0===ft?void 0:ft.translations)||void 0===Zt?void 0:Zt[0])||void 0===yt?void 0:yt.name,brand:{id:null===(T=null===(xt=this.product)||void 0===xt?void 0:xt.brand)||void 0===T?void 0:T.id}},barcodes:(null===(M=this.product)||void 0===M?void 0:M.barcodes)||[]}),this.validateForm.setControl("ingredients",this.fb.array(ae().sortBy((null===(Nt=null===(Ft=this.product)||void 0===Ft?void 0:Ft.productToIngredients)||void 0===Nt?void 0:Nt.map(qt=>{var wt,Rt,Et;return this.fb.group(this.unitConverter.convert({id:qt.ingredient.id,name:null===(wt=this.languageService.pick(this.languages,qt.ingredient.translations))||void 0===wt?void 0:wt.name,amount:(null===(Rt=qt.attributes)||void 0===Rt?void 0:Rt.amount)||void 0,amountUnit:(null===(Et=qt.attributes)||void 0===Et?void 0:Et.amountUnit)||void 0},"source"))}))||[],"value.name")))}),this.getHierarchicalCategoriesGQL.fetch().pipe((0,C.R)(this.destroy$)).subscribe(({data:e})=>{e&&(this.categories=e.categories.map(r=>{var d,u,_;return{key:`${r.id}`,title:null===(u=null===(d=r.translations)||void 0===d?void 0:d[0])||void 0===u?void 0:u.name,isLeaf:!1,children:null===(_=r.children)||void 0===_?void 0:_.map(c=>{var f,Z;return{key:`${c.id}`,title:null===(Z=null===(f=c.translations)||void 0===f?void 0:f[0])||void 0===Z?void 0:Z.name,isLeaf:!0}})}}))})}addVideo(){var e,n;this.validateForm.addControl("videoTitle",this.fb.control(null===(e=this.product)||void 0===e?void 0:e.videoTitle)),this.validateForm.addControl("videoUrl",this.fb.control(null===(n=this.product)||void 0===n?void 0:n.videoUrl))}removeVideo(){this.validateForm.removeControl("videoTitle"),this.validateForm.removeControl("videoUrl")}addImageDescription(){var e,n,o;this.validateForm.addControl("imageDescription",this.fb.control(null===(o=null===(n=null===(e=this.product)||void 0===e?void 0:e.translations)||void 0===n?void 0:n[0])||void 0===o?void 0:o.imageDescription))}removeImageDescription(){this.validateForm.removeControl("imageDescription")}isSmallDevice(){return this.breakpointObserver.isMatched([bt.u3.XSmall,bt.u3.Small])}openIngredientAnalysis(){this.drawerService.create({nzTitle:this.translateService.instant("product.analyze_ingredient"),nzContentParams:Object.assign({selectedIngredients:new Set(this.ingredients.value.map(n=>n.id))},this.ingredientAnalysisData||{}),nzContent:ge,nzMaskClosable:!1,nzWidth:this.breakpointObserver.isMatched([bt.u3.XSmall,bt.u3.Small])?"100%":"50%"}).afterClose.subscribe(n=>{var o,r;this.ingredientAnalysisData=n,(null===(o=null==n?void 0:n.newSelectedIngredients)||void 0===o?void 0:o.length)&&(null===(r=n.newSelectedIngredients)||void 0===r||r.forEach(d=>{this.ingredients.push(this.fb.group({id:d.id,name:d.target,amount:null,amountUnit:null}))}),this.ingredients.controls.sort((d,u)=>(d.value.name||"").localeCompare(u.value.name)),this.ingredients.controls=[...this.ingredients.controls])})}addIngredients(){!this.selectedIngredients.length||(this.selectedIngredients.forEach(e=>{this.ingredients.push(this.fb.group({id:e.ingredient.id,name:e.name,amount:null,amountUnit:null}))}),this.ingredients.controls.sort((e,n)=>(e.value.name||"").localeCompare(n.value.name)),this.ingredients.controls=[...this.ingredients.controls],this.selectedIngredients=[])}removeIngredient(e){this.ingredients.removeAt(e),this.ingredients.controls=[...this.ingredients.controls]}get ingredients(){return this.validateForm.get("ingredients")}generateSlug(){var e;const n=null===(e=this.validateForm.get("name"))||void 0===e?void 0:e.value;!(null==n?void 0:n.trim().length)||this.validateForm.patchValue({slug:this.stringService.stringToSlug(n)})}submitForm(){var e,n,o,r;if(Object.values(this.validateForm.controls).forEach(u=>{u.markAsDirty(),u.updateValueAndValidity()}),this.validateForm.invalid)return;let d;if(this.loading=!0,this.thumbnailFile){const u=new FormData;u.append("file",this.thumbnailFile),d=this.httpClient.post(`${Xt.N.apiUri}/single-upload?useWatermark=false`,u)}else d=(0,ie.of)({id:null===(n=null===(e=this.product)||void 0===e?void 0:e.thumbnail)||void 0===n?void 0:n.id,url:(null===(r=null===(o=this.product)||void 0===o?void 0:o.thumbnail)||void 0===r?void 0:r.url)||""});d.pipe((0,C.R)(this.destroy$),(0,oe.zg)(({id:u,url:_})=>{var c,f,Z,L,F,N,w,R,x,O,D,I,y,G,j,H,W,K,tt,et,nt,it,ot,rt,at,lt,st,dt,ut,ct,gt,pt,mt,ht,_t,vt,zt,ft,Zt;const yt=null===(c=this.validateForm.get("ingredients"))||void 0===c?void 0:c.value,xt={status:(null===(f=this.validateForm.get("status"))||void 0===f?void 0:f.value)?z.Pte.Active:z.Pte.Inactive,price:null===(Z=this.validateForm.get("price"))||void 0===Z?void 0:Z.value,measure:null===(L=this.validateForm.get("measure"))||void 0===L?void 0:L.value,videoTitle:null===(F=this.validateForm.get("videoTitle"))||void 0===F?void 0:F.value,videoUrl:null===(N=this.validateForm.get("videoUrl"))||void 0===N?void 0:N.value,brand:{connect:{id:null===(w=this.validateForm.get("brand"))||void 0===w?void 0:w.value.brand.id}},attribute:{create:{rdi:(null===(R=this.validateForm.get("rdi"))||void 0===R?void 0:R.value)||null,packagingUnit:null===(x=this.validateForm.get("packagingUnit"))||void 0===x?void 0:x.value,netWeightPerPackage:(null===(O=this.validateForm.get("netWeightPerPackage"))||void 0===O?void 0:O.value)||null,weightUnit:null===(D=this.validateForm.get("weightUnit"))||void 0===D?void 0:D.value,netVolumePerPackage:(null===(I=this.validateForm.get("netVolumePerPackage"))||void 0===I?void 0:I.value)||null,volumeUnit:null===(y=this.validateForm.get("volumeUnit"))||void 0===y?void 0:y.value,energyPerPackage:(null===(G=this.validateForm.get("energyPerPackage"))||void 0===G?void 0:G.value)||null,energyUnit:null===(j=this.validateForm.get("energyUnit"))||void 0===j?void 0:j.value}}};return(null===(H=this.product)||void 0===H?void 0:H.id)?this.updateProductGQL.mutate({where:{id:this.product.id},data:Object.assign(Object.assign({},xt),{categories:{set:null===(W=this.validateForm.get("categories"))||void 0===W?void 0:W.value.map(T=>({id:+T}))},barcodes:{create:null===(tt=null===(K=this.validateForm.get("barcodes"))||void 0===K?void 0:K.value)||void 0===tt?void 0:tt.filter(T=>T.label).map(T=>({value:T.label})),set:null===(nt=null===(et=this.validateForm.get("barcodes"))||void 0===et?void 0:et.value)||void 0===nt?void 0:nt.filter(T=>T.id).map(T=>({id:T.id}))},thumbnail:{connect:u&&{id:u}||void 0,create:!u&&this.thumbnailImage&&Object.assign(Object.assign({},this.thumbnailImage),{url:_})||void 0},productToIngredients:{create:yt.map(T=>{const M=this.unitConverter.convert(T,"target");return{ingredientId:M.id,attribute:T.amountUnit&&{create:{amount:M.amount||null,amountUnit:M.amountUnit||null}}||void 0}})},translations:{create:!(null===(ot=null===(it=this.product)||void 0===it?void 0:it.translations)||void 0===ot?void 0:ot[0])&&[{name:null===(rt=this.validateForm.get("name"))||void 0===rt?void 0:rt.value,description:null===(at=this.validateForm.get("description"))||void 0===at?void 0:at.value,language:z.spR.Vi,isOriginal:!0,imageDescription:(null===(lt=this.validateForm.get("imageDescription"))||void 0===lt?void 0:lt.value)||null,slug:null===(st=this.validateForm.get("slug"))||void 0===st?void 0:st.value}]||void 0,set:(null===(ut=null===(dt=this.product)||void 0===dt?void 0:dt.translations)||void 0===ut?void 0:ut[0])&&[{id:this.product.translations[0].id,name:null===(ct=this.validateForm.get("name"))||void 0===ct?void 0:ct.value,description:null===(gt=this.validateForm.get("description"))||void 0===gt?void 0:gt.value,language:z.spR.Vi,isOriginal:!0,imageDescription:(null===(pt=this.validateForm.get("imageDescription"))||void 0===pt?void 0:pt.value)||null,slug:null===(mt=this.validateForm.get("slug"))||void 0===mt?void 0:mt.value}]}})},{errorPolicy:"all"}):this.createProductGQL.mutate({data:Object.assign(Object.assign({},xt),{categories:{connect:null===(ht=this.validateForm.get("categories"))||void 0===ht?void 0:ht.value.map(T=>({id:+T}))},barcodes:{create:null===(_t=this.validateForm.get("barcodes"))||void 0===_t?void 0:_t.value.map(T=>({value:T.label}))},thumbnail:{create:this.thumbnailImage&&Object.assign(Object.assign({},this.thumbnailImage),{url:_})},productToIngredients:{create:yt.map(T=>{const M=this.unitConverter.convert(T,"target");return{ingredientId:M.id,attribute:T.amountUnit&&{create:{amount:M.amount||null,amountUnit:M.amountUnit||null}}||void 0}})},translations:{create:[{name:null===(vt=this.validateForm.get("name"))||void 0===vt?void 0:vt.value,description:null===(zt=this.validateForm.get("description"))||void 0===zt?void 0:zt.value,language:z.spR.Vi,isOriginal:!0,imageDescription:(null===(ft=this.validateForm.get("imageDescription"))||void 0===ft?void 0:ft.value)||null,slug:null===(Zt=this.validateForm.get("slug"))||void 0===Zt?void 0:Zt.value}]}})},{errorPolicy:"all"})})).subscribe(({errors:u,data:_})=>{var c,f;u&&this.msgService.error(this.translateService.instant(`product.${(null===(c=this.product)||void 0===c?void 0:c.id)?"update":"create"}_error`)),_&&(this.msgService.success(this.translateService.instant(`product.${(null===(f=this.product)||void 0===f?void 0:f.id)?"update":"create"}_success`)),this.location.back()),this.loading=!1},()=>{var u;this.msgService.error(this.translateService.instant(`product.${(null===(u=this.product)||void 0===u?void 0:u.id)?"update":"create"}_error`)),this.loading=!1})}cancel(){this.location.back()}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(g.qu),t.Y36(Q.gz),t.Y36(z.keB),t.Y36(Tt.eN),t.Y36(A.Ye),t.Y36(pe.I),t.Y36(z.cxX),t.Y36(z.qkA),t.Y36(J.dD),t.Y36(P.sK),t.Y36(me.P),t.Y36(he.T),t.Y36(bt.Yg),t.Y36(Qt.ai),t.Y36(_e.B))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-product-details"]],decls:181,vars:168,consts:[[1,"site-page-header"],["nz-page-header-breadcrumb",""],["nz-icon","","nzType","home"],["routerLink","/products"],["nz-form","",3,"nzLayout","formGroup","ngSubmit"],[1,"mb-3"],["nzHasFeedback","",3,"nzErrorTip"],["nz-input","","formControlName","name"],["nz-input","","formControlName","description",3,"nzAutosize"],["nzShowSearch","","nzAllowClear","","formControlName","categories",1,"w-100",3,"nzPlaceHolder","nzNodes","nzMultiple","nzDropdownStyle"],["formControlName","brand"],["formControlName","status"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzXs","nzSm","nzMd","nzLg","nzXl","nzXXl"],["formControlName","price",1,"w-100",3,"nzMin","nzStep","nzFormatter"],["nz-input","","formControlName","measure"],["nzHasFeedback",""],[3,"nzAddOnAfter"],["formControlName","rdi",1,"w-100",3,"nzMin","nzStep"],["packagingUnit",""],["formControlName","netWeightPerPackage",1,"w-100"],["weightAddOnAfterTemplate",""],["formControlName","netVolumePerPackage",1,"w-100"],["volumeAddOnAfterTemplate",""],["formControlName","energyPerPackage",1,"w-100"],["energyAddOnAfterTemplate",""],["bindLabel","value","formControlName","barcodes",3,"hideSelected","multiple","clearable","addTag"],["nzListType","picture-card",1,"cover-uploader",3,"nzBeforeUpload","nzShowUploadList"],[4,"ngIf"],["style","width: 100%",3,"src","appImgFallback",4,"ngIf"],["nz-row",""],[4,"ngIf","ngIfElse"],["elseVideo",""],["nz-row","",3,"nzGutter",4,"ngIf"],["elseImageDescription",""],[3,"nzSuffix"],["nz-input","","formControlName","slug"],["suffixTemplate",""],["nz-button","","nzType","dashed","type","button","nzBlock","",3,"click"],["nzSearch","",3,"nzAddOnAfter"],[3,"ngModel","ngModelOptions","ngModelChange"],["addIngredientsBtn",""],["nzTableLayout","fixed","formArrayName","ingredients",3,"nzData","nzPageSize"],["ingredientsTable",""],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"mt-2","pb-4"],["nz-button","","nzType","primary",3,"nzLoading"],["nz-button","","type","button",1,"ml-2",3,"nzDanger","click"],["formControlName","packagingUnit",1,"unit",3,"nzAllowClear"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],["formControlName","weightUnit",1,"unit",3,"nzAllowClear"],["formControlName","volumeUnit",1,"unit",3,"nzAllowClear"],["formControlName","energyUnit",1,"unit",3,"nzAllowClear"],["nz-icon","","nzType","camera","nzTheme","outline",1,"upload-icon"],[2,"width","100%",3,"src","appImgFallback"],["nz-button","","nzType","dashed","type","button",1,"mb-2",3,"click"],["nz-icon","","nzType","plus"],["nz-button","","nzType","dashed","nzDanger","","type","button",1,"mb-2",3,"click"],["nz-icon","","nzType","minus"],["nz-input","","formControlName","videoTitle"],["nz-input","","formControlName","videoUrl"],["apiKey","fogegal2uijx4gnuleljxppluzgepbi58urxfi2k5ul8y79d","formControlName","imageDescription",3,"init"],["nz-icon","","nzType","sync","nzTheme","outline","nz-tooltip","",3,"nzTooltipTitle","click"],["nz-button","","nzType","primary","type","button","nzSearch","",3,"click"],["nz-icon","","nzType","down","nzTheme","outline"],[3,"formGroupName"],["formControlName","amount","type","number",1,"w-100"],["unitTemplate",""],["nz-button","","nzType","text","nzDanger","",3,"click"],["nz-icon","","nzType","delete","nzTheme","outline"],["formControlName","amountUnit","nzAllowClear","",1,"unit",3,"nzAllowClear"]],template:function(e,n){if(1&e&&(t.TgZ(0,"nz-page-header",0),t.TgZ(1,"nz-breadcrumb",1),t.TgZ(2,"nz-breadcrumb-item"),t._UZ(3,"i",2),t.qZA(),t.TgZ(4,"nz-breadcrumb-item"),t.TgZ(5,"a",3),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.qZA(),t.TgZ(8,"nz-breadcrumb-item"),t.TgZ(9,"a"),t._uU(10),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"form",4),t.NdJ("ngSubmit",function(){return n.submitForm()}),t.TgZ(12,"nz-card",5),t.TgZ(13,"nz-form-item"),t.TgZ(14,"nz-form-label"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"nz-form-control",6),t.ALo(18,"translate"),t._UZ(19,"input",7),t.qZA(),t.qZA(),t.TgZ(20,"nz-form-item"),t.TgZ(21,"nz-form-label"),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"nz-form-control",6),t.ALo(25,"translate"),t._UZ(26,"textarea",8),t.qZA(),t.qZA(),t.TgZ(27,"nz-form-item"),t.TgZ(28,"nz-form-label"),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"nz-form-control",6),t.ALo(32,"translate"),t._UZ(33,"nz-tree-select",9),t.ALo(34,"translate"),t.qZA(),t.qZA(),t.TgZ(35,"nz-form-item"),t.TgZ(36,"nz-form-label"),t._uU(37),t.ALo(38,"translate"),t.qZA(),t.TgZ(39,"nz-form-control",6),t.ALo(40,"translate"),t._UZ(41,"app-brand-select",10),t.qZA(),t.qZA(),t.TgZ(42,"nz-form-item"),t.TgZ(43,"nz-form-label"),t._uU(44),t.ALo(45,"translate"),t.qZA(),t.TgZ(46,"nz-form-control"),t._UZ(47,"nz-switch",11),t.qZA(),t.qZA(),t.qZA(),t.TgZ(48,"nz-card",5),t.TgZ(49,"div",12),t.TgZ(50,"div",13),t.TgZ(51,"nz-form-item"),t.TgZ(52,"nz-form-label"),t._uU(53),t.ALo(54,"translate"),t.qZA(),t.TgZ(55,"nz-form-control",6),t.ALo(56,"translate"),t._UZ(57,"nz-input-number",14),t.qZA(),t.qZA(),t.qZA(),t.TgZ(58,"div",13),t.TgZ(59,"nz-form-item"),t.TgZ(60,"nz-form-label"),t._uU(61),t.ALo(62,"translate"),t.qZA(),t.TgZ(63,"nz-form-control",6),t.ALo(64,"translate"),t._UZ(65,"input",15),t.qZA(),t.qZA(),t.qZA(),t.TgZ(66,"div",13),t.TgZ(67,"nz-form-item"),t.TgZ(68,"nz-form-label"),t._uU(69),t.ALo(70,"translate"),t.qZA(),t.TgZ(71,"nz-form-control",16),t.TgZ(72,"nz-input-group",17),t._UZ(73,"nz-input-number",18),t.qZA(),t.YNc(74,Te,2,2,"ng-template",null,19,t.W1O),t.qZA(),t.qZA(),t.qZA(),t.TgZ(76,"div",13),t.TgZ(77,"nz-form-item"),t.TgZ(78,"nz-form-label"),t._uU(79),t.ALo(80,"translate"),t.qZA(),t.TgZ(81,"nz-form-control",16),t.TgZ(82,"nz-input-group",17),t._UZ(83,"nz-input-number",20),t.qZA(),t.YNc(84,be,2,2,"ng-template",null,21,t.W1O),t.qZA(),t.qZA(),t.qZA(),t.TgZ(86,"div",13),t.TgZ(87,"nz-form-item"),t.TgZ(88,"nz-form-label"),t._uU(89),t.ALo(90,"translate"),t.qZA(),t.TgZ(91,"nz-form-control",16),t.TgZ(92,"nz-input-group",17),t._UZ(93,"nz-input-number",22),t.qZA(),t.YNc(94,ye,2,2,"ng-template",null,23,t.W1O),t.qZA(),t.qZA(),t.qZA(),t.TgZ(96,"div",13),t.TgZ(97,"nz-form-item"),t.TgZ(98,"nz-form-label"),t._uU(99),t.ALo(100,"translate"),t.qZA(),t.TgZ(101,"nz-form-control",16),t.TgZ(102,"nz-input-group",17),t._UZ(103,"nz-input-number",24),t.qZA(),t.YNc(104,qe,2,2,"ng-template",null,25,t.W1O),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(106,"nz-form-item"),t.TgZ(107,"nz-form-label"),t._uU(108),t.ALo(109,"translate"),t.qZA(),t.TgZ(110,"nz-form-control",16),t._UZ(111,"ng-select",26),t.qZA(),t.qZA(),t.qZA(),t.TgZ(112,"nz-card",5),t.TgZ(113,"nz-form-item"),t.TgZ(114,"nz-form-label"),t._uU(115),t.ALo(116,"translate"),t.qZA(),t.TgZ(117,"nz-form-control"),t.TgZ(118,"nz-upload",27),t.YNc(119,Se,2,0,"ng-container",28),t.YNc(120,Ie,1,3,"img",29),t.qZA(),t.qZA(),t.qZA(),t.TgZ(121,"div",30),t.YNc(122,Ue,5,3,"ng-container",31),t.YNc(123,Pe,4,3,"ng-template",null,32,t.W1O),t.qZA(),t.YNc(125,Le,15,19,"div",33),t.TgZ(126,"div",30),t.YNc(127,Oe,5,3,"ng-container",31),t.YNc(128,De,4,3,"ng-template",null,34,t.W1O),t.qZA(),t.YNc(130,we,6,8,"nz-form-item",28),t.qZA(),t.TgZ(131,"nz-card",5),t.TgZ(132,"nz-form-item"),t.TgZ(133,"nz-form-label"),t._uU(134),t.ALo(135,"translate"),t.qZA(),t.TgZ(136,"nz-form-control",6),t.ALo(137,"translate"),t.TgZ(138,"nz-input-group",35),t._UZ(139,"input",36),t.YNc(140,Re,2,3,"ng-template",null,37,t.W1O),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(142,"nz-card",5),t.TgZ(143,"nz-form-item"),t.TgZ(144,"button",38),t.NdJ("click",function(){return n.openIngredientAnalysis()}),t._uU(145),t.ALo(146,"translate"),t.qZA(),t.qZA(),t.TgZ(147,"nz-form-item"),t.TgZ(148,"nz-input-group",39),t.TgZ(149,"app-ingredient-select",40),t.NdJ("ngModelChange",function(r){return n.selectedIngredients=r}),t.qZA(),t.qZA(),t.YNc(150,Ee,4,3,"ng-template",null,41,t.W1O),t.qZA(),t.TgZ(152,"nz-form-item"),t.TgZ(153,"nz-form-label"),t._uU(154),t.ALo(155,"translate"),t.qZA(),t.TgZ(156,"nz-form-control",16),t.TgZ(157,"nz-table",42,43),t.TgZ(159,"thead"),t.TgZ(160,"tr"),t.TgZ(161,"th"),t._uU(162,"ID"),t.qZA(),t.TgZ(163,"th"),t._uU(164),t.ALo(165,"translate"),t.qZA(),t.TgZ(166,"th"),t._uU(167),t.ALo(168,"translate"),t.qZA(),t._UZ(169,"th"),t.qZA(),t.qZA(),t.TgZ(170,"tbody"),t.YNc(171,Ye,13,4,"tr",44),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(172,"nz-form-item",45),t.TgZ(173,"nz-form-control"),t.TgZ(174,"nz-input-group"),t.TgZ(175,"button",46),t._uU(176),t.ALo(177,"translate"),t.qZA(),t.TgZ(178,"button",47),t.NdJ("click",function(){return n.cancel()}),t._uU(179),t.ALo(180,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e){const o=t.MAs(75),r=t.MAs(85),d=t.MAs(95),u=t.MAs(105),_=t.MAs(124),c=t.MAs(129),f=t.MAs(141),Z=t.MAs(151),L=t.MAs(158);t.xp6(6),t.Oqu(t.lcZ(7,105,"common.product")),t.xp6(4),t.Oqu(null==((null==n.product?null:n.product.translations)||t.DdM(163,kt))[0]?null:((null==n.product?null:n.product.translations)||t.DdM(164,kt))[0].name),t.xp6(1),t.Q6J("nzLayout","vertical")("formGroup",n.validateForm),t.xp6(4),t.Oqu(t.lcZ(16,107,"product.name")),t.xp6(2),t.s9C("nzErrorTip",t.lcZ(18,109,"ui.form.should_not_be_empty")),t.xp6(5),t.Oqu(t.lcZ(23,111,"product.description")),t.xp6(2),t.s9C("nzErrorTip",t.lcZ(25,113,"ui.form.should_not_be_empty")),t.xp6(2),t.Q6J("nzAutosize",t.DdM(165,Be)),t.xp6(3),t.Oqu(t.lcZ(30,115,"common.category")),t.xp6(2),t.s9C("nzErrorTip",t.lcZ(32,117,"ui.form.should_not_be_empty")),t.xp6(2),t.s9C("nzPlaceHolder",t.lcZ(34,119,"common.category")),t.Q6J("nzNodes",n.categories)("nzMultiple",!0)("nzDropdownStyle",t.DdM(166,Ve)),t.xp6(4),t.Oqu(t.lcZ(38,121,"common.brand")),t.xp6(2),t.s9C("nzErrorTip",t.lcZ(40,123,"ui.form.should_not_be_empty")),t.xp6(5),t.Oqu(t.lcZ(45,125,"common.status")),t.xp6(5),t.Q6J("nzGutter",16),t.xp6(1),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",12)("nzXl",12)("nzXXl",12),t.xp6(3),t.Oqu(t.lcZ(54,127,"common.price")),t.xp6(2),t.s9C("nzErrorTip",t.lcZ(56,129,"ui.form.should_not_be_empty")),t.xp6(2),t.Q6J("nzMin",1e3)("nzStep",5e3)("nzFormatter",n.formatterVnd),t.xp6(1),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",12)("nzXl",12)("nzXXl",12),t.xp6(3),t.Oqu(t.lcZ(62,131,"common.measure")),t.xp6(2),t.s9C("nzErrorTip",t.lcZ(64,133,"ui.form.should_not_be_empty")),t.xp6(3),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",12)("nzXl",12)("nzXXl",12),t.xp6(3),t.Oqu(t.lcZ(70,135,"product.rdi_packaging_unit")),t.xp6(3),t.Q6J("nzAddOnAfter",o),t.xp6(1),t.Q6J("nzMin",1)("nzStep",1),t.xp6(3),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",12)("nzXl",12)("nzXXl",12),t.xp6(3),t.Oqu(t.lcZ(80,137,"product.net_weight_per_package")),t.xp6(3),t.Q6J("nzAddOnAfter",r),t.xp6(4),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",12)("nzXl",12)("nzXXl",12),t.xp6(3),t.Oqu(t.lcZ(90,139,"product.net_volume_per_package")),t.xp6(3),t.Q6J("nzAddOnAfter",d),t.xp6(4),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",12)("nzXl",12)("nzXXl",12),t.xp6(3),t.Oqu(t.lcZ(100,141,"product.energy_per_package")),t.xp6(3),t.Q6J("nzAddOnAfter",u),t.xp6(6),t.Oqu(t.lcZ(109,143,"common.barcode")),t.xp6(3),t.Q6J("hideSelected",!0)("multiple",!0)("clearable",!0)("addTag",!0),t.xp6(4),t.Oqu(t.lcZ(116,145,"event.cover")),t.xp6(3),t.Q6J("nzBeforeUpload",n.beforeUploadThumbnail)("nzShowUploadList",!1),t.xp6(1),t.Q6J("ngIf",!n.thumbnailImage),t.xp6(1),t.Q6J("ngIf",n.thumbnailImage),t.xp6(2),t.Q6J("ngIf",!n.validateForm.get("videoTitle"))("ngIfElse",_),t.xp6(3),t.Q6J("ngIf",n.validateForm.get("videoTitle")),t.xp6(2),t.Q6J("ngIf",!n.validateForm.get("imageDescription"))("ngIfElse",c),t.xp6(3),t.Q6J("ngIf",n.validateForm.get("imageDescription")),t.xp6(4),t.Oqu(t.lcZ(135,147,"product.web_url")),t.xp6(2),t.s9C("nzErrorTip",t.lcZ(137,149,"ui.form.should_not_be_empty")),t.xp6(2),t.Q6J("nzSuffix",f),t.xp6(7),t.hij(" ",t.lcZ(146,151,"ingredient.analyze_from_cosdna_skincarisma")," "),t.xp6(3),t.Q6J("nzAddOnAfter",Z),t.xp6(1),t.Q6J("ngModel",n.selectedIngredients)("ngModelOptions",t.DdM(167,Ge)),t.xp6(5),t.Oqu(t.lcZ(155,153,"common.ingredient")),t.xp6(3),t.Q6J("nzData",n.ingredients.controls)("nzPageSize",10),t.xp6(7),t.Oqu(t.lcZ(165,155,"ingredient.name")),t.xp6(3),t.Oqu(t.lcZ(168,157,"ingredient.content")),t.xp6(4),t.Q6J("ngForOf",L.data),t.xp6(4),t.Q6J("nzLoading",n.loading),t.xp6(1),t.hij(" ",t.lcZ(177,159,null!=n.product&&n.product.id?"common.update":"common.add")," "),t.xp6(2),t.Q6J("nzDanger",!0),t.xp6(1),t.hij(" ",t.lcZ(180,161,"common.cancel")," ")}},directives:[s.$O,S.Dg,s.A2,S.MO,Ot.w,X.Ls,Q.yS,g._Y,g.JL,k.Lr,g.sg,At.bd,E.SK,k.Nx,E.t3,k.iK,k.Fd,U.Zp,g.Fj,g.JJ,g.u,U.rh,Ut.zr,Ht,h.i,Mt._,U.gB,q.w9,b.FY,A.O5,U.ke,$.ix,Dt.dQ,fe,g.On,v.N8,g.CE,v.Om,v.$Z,v.Uo,v._C,v.p0,A.sg,Y.Vq,Y.Ip,Jt.Z,m.PG,B.SY,g.x0],pipes:[P.X$],styles:["[_nghost-%COMP%]     .cover-uploader>.ant-upload{overflow:hidden}.unit[_ngcontent-%COMP%]{min-width:100px}"]}),i})();function He(i,l){if(1&i&&(t.TgZ(0,"nz-tag"),t._uU(1),t.qZA()),2&i){const e=l.$implicit;t.xp6(1),t.Oqu(null==e.translations[0]?null:e.translations[0].name)}}const We=function(){return[]},Ke=function(i){return["/products",i]};function tn(i,l){if(1&i&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t.TgZ(4,"div",19),t.TgZ(5,"div",20),t._UZ(6,"img",21),t.qZA(),t.TgZ(7,"span",22),t.TgZ(8,"strong"),t._uU(9),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(10,"td"),t.TgZ(11,"div",23),t._UZ(12,"img",21),t.qZA(),t.qZA(),t.TgZ(13,"td"),t.YNc(14,He,2,1,"nz-tag",24),t.qZA(),t.TgZ(15,"td"),t.TgZ(16,"nz-tag",25),t._uU(17),t.qZA(),t.qZA(),t.TgZ(18,"td"),t.TgZ(19,"a",26),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.qZA(),t.qZA()),2&i){const e=l.$implicit,n=t.oxw();t.xp6(2),t.Oqu(e.id),t.xp6(4),t.Q6J("src",null==e.thumbnail||null==e.thumbnail.small?null:e.thumbnail.small.url,t.LSH)("appImgFallback",(null==e.thumbnail?null:e.thumbnail.url)||t.DdM(13,We)),t.xp6(3),t.Oqu(null==e.translations[0]?null:e.translations[0].name),t.xp6(3),t.Q6J("src",e.brand.smallLogoUrl,t.LSH)("appImgFallback",e.brand.logoUrl),t.xp6(2),t.Q6J("ngForOf",e.categories),t.xp6(2),t.Q6J("nzColor",e.status===n.ProductStatus.Active?"success":"error"),t.xp6(1),t.Oqu(e.status),t.xp6(2),t.Q6J("routerLink",t.VKq(14,Ke,e.id)),t.xp6(1),t.Oqu(t.lcZ(21,11,"common.edit"))}}const en=function(){return[16,8]},nn=function(){return{"max-height":"300px"}};let on=(()=>{class i{constructor(e,n,o,r,d,u,_,c){this.getProductListGQL=e,this.getHierarchicalCategoriesGQL=n,this.searchBrandsGQL=o,this.route=r,this.router=d,this.msgService=u,this.translateService=_,this.fb=c,this.ProductStatus=z.Pte,this.destroy$=new Ct.xQ,this.products=[],this.productsCount=0,this.pageIndex=1,this.pageSize=10,this.loading=!1,this.categories=[],this.searchForm=this.fb.group({product:[null],brand:[null],category:[null],status:[void 0]})}ngOnInit(){this.route.queryParamMap.pipe((0,C.R)(this.destroy$)).subscribe(e=>{this.pageIndex=parseInt(e.get("page")||"1",10),this.pageSize=parseInt(e.get("size")||"10",10),this.categoryId=parseInt(e.get("category")||"0",10)||void 0,this.brandId=parseInt(e.get("brand")||"0",10)||void 0,this.text=e.get("text")||"",this.status=Object.values(z.Pte).includes(e.get("status"))?e.get("status"):void 0,this.patchFormValue(),this.dataSubscription?this.refetch():(this.dataQueryRef=this.getProductListGQL.watch(this.getVariables(),{notifyOnNetworkStatusChange:!0,fetchPolicy:"network-only"}),this.dataSubscription=this.dataQueryRef.valueChanges.pipe((0,C.R)(this.destroy$)).subscribe(({data:n,loading:o,error:r,errors:d})=>{if(this.loading=o,!o){if(r||d)return void this.msgService.error(this.translateService.instant("ui.message.can_not_load_data"));n&&(this.products=n.products,this.productsCount=n.productsConnection.aggregate.count)}}))}),this.getHierarchicalCategoriesGQL.fetch().pipe((0,C.R)(this.destroy$)).subscribe(({data:e})=>{e&&(this.categories=e.categories.map(r=>{var d,u,_;return{key:`${r.id}`,title:null===(u=null===(d=r.translations)||void 0===d?void 0:d[0])||void 0===u?void 0:u.name,isLeaf:!1,children:null===(_=r.children)||void 0===_?void 0:_.map(c=>{var f,Z;return{key:`${c.id}`,title:null===(Z=null===(f=c.translations)||void 0===f?void 0:f[0])||void 0===Z?void 0:Z.name,isLeaf:!0}})}}))})}patchFormValue(){this.categoryId&&this.searchForm.controls.category.untouched&&this.searchForm.patchValue({category:`${this.categoryId}`}),this.brandId&&this.searchForm.controls.brand.untouched&&this.searchForm.controls.brand.pristine&&this.searchBrandsGQL.fetch({where:{id:this.brandId},first:1}).pipe((0,C.R)(this.destroy$)).subscribe(({data:e})=>{var n,o,r;(null===(n=null==e?void 0:e.brands)||void 0===n?void 0:n.length)&&this.searchForm.patchValue({brand:{name:null===(r=null===(o=e.brands[0].translations)||void 0===o?void 0:o[0])||void 0===r?void 0:r.name,brand:{id:e.brands[0].id}}})}),this.text&&this.searchForm.controls.product.untouched&&this.searchForm.patchValue({product:this.text}),this.searchForm.controls.status.untouched&&this.searchForm.patchValue({status:this.status||void 0})}refetch(){var e;null===(e=this.dataQueryRef)||void 0===e||e.refetch(this.getVariables())}getVariables(){return{where:{nameContains:this.text||void 0,categoriesSome:{id:this.categoryId||void 0},brand:{id:this.brandId||void 0},status:this.status||void 0},first:this.pageSize,skip:(this.pageIndex-1)*this.pageSize,orderBy:[{id:z.d$J.Desc}]}}handleQueryParamsChange(e){this.router.navigate([],{queryParams:{page:e.pageIndex,size:e.pageSize},relativeTo:this.route,queryParamsHandling:"merge"})}handleSearch(){var e;const n=this.searchForm.value,o=(null===(e=n.brand)||void 0===e?void 0:e.brand.id)||void 0,r=parseInt(n.category,10)||void 0;this.router.navigate([],{queryParams:{text:n.product||void 0,brand:o,category:r,status:n.status||void 0},relativeTo:this.route,queryParamsHandling:"merge"})}trackById(e,n){return n.id}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(z._qI),t.Y36(z.keB),t.Y36(z.C1p),t.Y36(Q.gz),t.Y36(Q.F0),t.Y36(J.dD),t.Y36(P.sK),t.Y36(g.qu))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-product-list"]],decls:60,vars:80,consts:[[1,"site-page-header",3,"nzTitle"],["nz-page-header-breadcrumb",""],["nz-icon","","nzType","home"],["nz-button","","nzType","primary","routerLink","/products/new"],["nz-icon","","nzType","plus","nzTheme","outline"],[1,"mb-3"],["nz-form","",3,"formGroup","ngSubmit"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzXs","nzSm","nzMd","nzLg","nzXl","nzXXl"],["formControlName","status"],["nz-radio-button","",3,"nzValue","click"],["nzShowSearch","","nzAllowClear","","formControlName","category",1,"w-100",3,"nzPlaceHolder","nzNodes","nzDropdownStyle"],["formControlName","brand"],["nz-input","","formControlName","product",3,"placeholder"],["nz-button","","nzType","primary","type","submit"],["nz-icon","","nzType","search","nzTheme","outline"],[1,"mb-4"],["nzBordered","",3,"nzData","nzFrontPagination","nzTotal","nzPageIndex","nzPageSize","nzLoading","nzQueryParams"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","justify-content-start","align-items-center"],[1,"product-thumbnail","mr-2","img-thumbnail","flex-grow-0","flex-shrink-0"],["loading","lazy",3,"src","appImgFallback"],["nz-typography",""],[1,"brand-logo","img-thumbnail"],[4,"ngFor","ngForOf"],[3,"nzColor"],[3,"routerLink"]],template:function(e,n){1&e&&(t.TgZ(0,"nz-page-header",0),t.ALo(1,"translate"),t.TgZ(2,"nz-breadcrumb",1),t.TgZ(3,"nz-breadcrumb-item"),t._UZ(4,"i",2),t.qZA(),t.TgZ(5,"nz-breadcrumb-item"),t.TgZ(6,"a"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"nz-page-header-extra"),t.TgZ(10,"button",3),t._UZ(11,"i",4),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(14,"nz-card",5),t.TgZ(15,"form",6),t.NdJ("ngSubmit",function(){return n.handleSearch()}),t.TgZ(16,"div",7),t.TgZ(17,"div",8),t.TgZ(18,"nz-radio-group",9),t.TgZ(19,"label",10),t.NdJ("click",function(){return n.handleSearch()}),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"label",10),t.NdJ("click",function(){return n.handleSearch()}),t._uU(23,"Active"),t.qZA(),t.TgZ(24,"label",10),t.NdJ("click",function(){return n.handleSearch()}),t._uU(25,"Inactive"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(26,"div",8),t._UZ(27,"nz-tree-select",11),t.ALo(28,"translate"),t.qZA(),t.TgZ(29,"div",8),t._UZ(30,"app-brand-select",12),t.qZA(),t.TgZ(31,"div",8),t._UZ(32,"input",13),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"div",8),t.TgZ(35,"button",14),t._UZ(36,"i",15),t._uU(37),t.ALo(38,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(39,"nz-card",16),t.TgZ(40,"nz-table",17),t.NdJ("nzQueryParams",function(r){return n.handleQueryParamsChange(r)}),t.TgZ(41,"thead"),t.TgZ(42,"tr"),t.TgZ(43,"th"),t._uU(44,"ID"),t.qZA(),t.TgZ(45,"th"),t._uU(46),t.ALo(47,"translate"),t.qZA(),t.TgZ(48,"th"),t._uU(49),t.ALo(50,"translate"),t.qZA(),t.TgZ(51,"th"),t._uU(52),t.ALo(53,"translate"),t.qZA(),t.TgZ(54,"th"),t._uU(55),t.ALo(56,"translate"),t.qZA(),t._UZ(57,"th"),t.qZA(),t.qZA(),t.TgZ(58,"tbody"),t.YNc(59,tn,22,16,"tr",18),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.s9C("nzTitle",t.lcZ(1,56,"common.product")),t.xp6(7),t.Oqu(t.lcZ(8,58,"common.product")),t.xp6(5),t.hij(" ",t.lcZ(13,60,"product.create")," "),t.xp6(3),t.Q6J("formGroup",n.searchForm),t.xp6(1),t.Q6J("nzGutter",t.DdM(78,en)),t.xp6(1),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",24)("nzXl",24)("nzXXl",24),t.xp6(2),t.Q6J("nzValue",void 0),t.xp6(1),t.Oqu(t.lcZ(21,62,"common.all")),t.xp6(2),t.Q6J("nzValue",n.ProductStatus.Active),t.xp6(2),t.Q6J("nzValue",n.ProductStatus.Inactive),t.xp6(2),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",6)("nzXl",6)("nzXXl",6),t.xp6(1),t.s9C("nzPlaceHolder",t.lcZ(28,64,"common.category")),t.Q6J("nzNodes",n.categories)("nzDropdownStyle",t.DdM(79,nn)),t.xp6(2),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",6)("nzXl",6)("nzXXl",6),t.xp6(2),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",6)("nzXl",6)("nzXXl",6),t.xp6(1),t.s9C("placeholder",t.lcZ(33,66,"product.name")),t.xp6(2),t.Q6J("nzXs",24)("nzSm",24)("nzMd",24)("nzLg",6)("nzXl",6)("nzXXl",6),t.xp6(3),t.hij(" ",t.lcZ(38,68,"common.search")," "),t.xp6(3),t.Q6J("nzData",n.products)("nzFrontPagination",!1)("nzTotal",n.productsCount)("nzPageIndex",n.pageIndex)("nzPageSize",n.pageSize)("nzLoading",n.loading),t.xp6(6),t.Oqu(t.lcZ(47,70,"product.name")),t.xp6(3),t.Oqu(t.lcZ(50,72,"common.brand")),t.xp6(3),t.Oqu(t.lcZ(53,74,"common.category")),t.xp6(3),t.Oqu(t.lcZ(56,76,"common.status")),t.xp6(4),t.Q6J("ngForOf",n.products)("ngForTrackBy",n.trackById))},directives:[s.$O,S.Dg,s.A2,S.MO,Ot.w,X.Ls,s.Jp,$.ix,Dt.dQ,Q.rH,At.bd,g._Y,g.JL,k.Lr,g.sg,E.SK,E.t3,Lt.Dg,g.JJ,g.u,Lt.Of,Lt.Bq,Ut.zr,Ht,U.Zp,g.Fj,v.N8,v.Om,v.$Z,v.Uo,v._C,v.p0,A.sg,Jt.Z,It.ZU,St.j,Q.yS],pipes:[P.X$],styles:[".product-thumbnail[_ngcontent-%COMP%]{width:80px;height:80px;position:relative;overflow:hidden}.product-thumbnail[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}.brand-logo[_ngcontent-%COMP%]{width:100px;height:50px;position:relative;overflow:hidden}.brand-logo[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}"]}),i})();const rn=function(){return[]};function an(i,l){if(1&i&&t._UZ(0,"img",17),2&i){const e=t.oxw().$implicit;t.Q6J("src",null==e.user.avatar||null==e.user.avatar.small?null:e.user.avatar.small.url,t.LSH)("appImgFallback",(null==e.user.avatar?null:e.user.avatar.url)||t.DdM(2,rn))}}function ln(i,l){if(1&i&&(t._UZ(0,"nz-avatar",18),t.ALo(1,"slice")),2&i){const e=t.oxw().$implicit;t.Q6J("nzText",t.Dn7(1,1,e.user.account,0,2))}}function sn(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw().viewImages(o.images,o.id)}),t.TgZ(1,"i",20),t.O4$(),t.TgZ(2,"svg",21),t._UZ(3,"path",22),t.qZA(),t.qZA(),t._uU(4),t.ALo(5,"translate"),t.qZA()}2&i&&(t.xp6(4),t.hij(" ",t.lcZ(5,1,"product.view_image")," "))}function dn(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t._UZ(3,"div",6),t.qZA(),t.TgZ(4,"td"),t.TgZ(5,"div",7),t.TgZ(6,"div",8),t.YNc(7,an,1,3,"img",9),t.YNc(8,ln,2,5,"nz-avatar",10),t.qZA(),t.TgZ(9,"div",11),t.TgZ(10,"span",12),t.TgZ(11,"strong"),t._uU(12),t.qZA(),t._uU(13,"\xa0 "),t._UZ(14,"i",13),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(15,"td",14),t._uU(16),t.qZA(),t.TgZ(17,"td"),t.YNc(18,sn,6,3,"button",15),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.ALo(21,"date"),t.qZA(),t.TgZ(22,"td"),t.TgZ(23,"nz-switch",16),t.NdJ("click",function(){const o=t.CHM(e),r=o.$implicit,d=o.index;return t.oxw().updateStatus(r,d)}),t.qZA(),t.qZA(),t.qZA()}if(2&i){const e=l.$implicit,n=l.index,o=t.oxw();t.xp6(2),t.hij(" ",e.id," "),t.xp6(1),t.s9C("id","lightgallery_"+e.id),t.xp6(4),t.Q6J("ngIf",!(null==e.user.avatar||!e.user.avatar.url)),t.xp6(1),t.Q6J("ngIf",!e.user.avatar),t.xp6(4),t.Oqu(e.user.account),t.xp6(2),t.Q6J("nzType",e.user.gender===o.Gender.Male?"man":"woman"),t.xp6(2),t.Oqu(e.content),t.xp6(2),t.Q6J("ngIf",!(null==e.images||!e.images.length)),t.xp6(2),t.Oqu(t.xi3(21,12,e.createdAt,"short")),t.xp6(3),t.Q6J("ngModel",e.isDone)("nzControl",!0)("nzLoading",o.switchings[n])}}let un=(()=>{class i{constructor(e,n,o,r,d,u){this.getProductRequestsGQL=e,this.route=n,this.router=o,this.msgService=r,this.translateService=d,this.updateProductRequestGQL=u,this.Gender=z.Y0t,this.destroy$=new Ct.xQ,this.requests=[],this.requestsCount=0,this.pageIndex=1,this.pageSize=10,this.loading=!1,this.switchings=[]}ngOnInit(){this.route.queryParamMap.pipe((0,C.R)(this.destroy$)).subscribe(e=>{this.pageIndex=parseInt(e.get("page")||"1",10),this.pageSize=parseInt(e.get("size")||"10",10),this.dataSubscription?this.refetch():(this.dataQueryRef=this.getProductRequestsGQL.watch(this.getVariables(),{notifyOnNetworkStatusChange:!0,fetchPolicy:"network-only"}),this.dataSubscription=this.dataQueryRef.valueChanges.pipe((0,C.R)(this.destroy$)).subscribe(({data:n,loading:o,error:r,errors:d})=>{if(this.loading=o,!o){if(r||d)return void this.msgService.error(this.translateService.instant("ui.message.can_not_load_data"));n&&(this.requests=[...n.productRequests],this.requestsCount=n.productRequestsConnection.aggregate.count,this.switchings=Array(this.requestsCount).fill(!1))}}))})}refetch(){var e;null===(e=this.dataQueryRef)||void 0===e||e.refetch(this.getVariables())}getVariables(){return{where:{},first:this.pageSize,skip:(this.pageIndex-1)*this.pageSize,orderBy:{id:z.d$J.Desc}}}handleQueryParamsChange(e){this.router.navigate([],{queryParams:{page:e.pageIndex,size:e.pageSize},relativeTo:this.route,queryParamsHandling:"merge"})}trackById(e,n){return n.id}viewImages(e,n){lightGallery(document.getElementById(`lightgallery_${n}`),{dynamic:!0,dynamicEl:e.map(o=>({src:o}))})}updateStatus(e,n){this.switchings[n]=!0,this.updateProductRequestGQL.mutate({where:{id:e.id},data:{isDone:!e.isDone}},{errorPolicy:"all"}).pipe((0,C.R)(this.destroy$)).subscribe(({errors:o,data:r})=>{this.switchings[n]=!1,o?this.msgService.error(this.translateService.instant("product.update_status_error")):r&&(this.msgService.success(this.translateService.instant("product.update_status_success")),this.requests[n]=Object.assign(Object.assign({},e),{isDone:!e.isDone}),this.requests=[...this.requests])},()=>{this.msgService.error(this.translateService.instant("product.update_status_error")),this.switchings[n]=!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(z.sjY),t.Y36(Q.gz),t.Y36(Q.F0),t.Y36(J.dD),t.Y36(P.sK),t.Y36(z.K$j))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-product-request-list"]],decls:36,vars:32,consts:[[1,"site-page-header",3,"nzTitle"],["nz-page-header-breadcrumb",""],["nz-icon","","nzType","home"],[1,"mb-4"],["nzBordered","",3,"nzData","nzFrontPagination","nzTotal","nzPageIndex","nzPageSize","nzLoading","nzQueryParams"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-none",3,"id"],[1,"d-flex","justify-content-between","align-items-center"],[1,"avatar","mr-2","flex-grow-0","flex-shrink-0"],[3,"src","appImgFallback",4,"ngIf"],[3,"nzText",4,"ngIf"],[1,"d-flex","flex-column","flex-grow-1"],["nz-typography",""],["nz-icon","",3,"nzType"],["nzBreakWord",""],["nz-button","","nzType","dashed",3,"click",4,"ngIf"],[3,"ngModel","nzControl","nzLoading","click"],[3,"src","appImgFallback"],[3,"nzText"],["nz-button","","nzType","dashed",3,"click"],["nz-icon",""],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"]],template:function(e,n){1&e&&(t.TgZ(0,"nz-page-header",0),t.ALo(1,"translate"),t.TgZ(2,"nz-breadcrumb",1),t.TgZ(3,"nz-breadcrumb-item"),t._UZ(4,"i",2),t.qZA(),t.TgZ(5,"nz-breadcrumb-item"),t.TgZ(6,"a"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.qZA(),t.TgZ(9,"nz-breadcrumb-item"),t.TgZ(10,"a"),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(13,"nz-card",3),t.TgZ(14,"nz-table",4),t.NdJ("nzQueryParams",function(r){return n.handleQueryParamsChange(r)}),t.TgZ(15,"thead"),t.TgZ(16,"tr"),t.TgZ(17,"th"),t._uU(18,"ID"),t.qZA(),t.TgZ(19,"th"),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"th"),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"th"),t._uU(26),t.ALo(27,"translate"),t.qZA(),t.TgZ(28,"th"),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"th"),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(34,"tbody"),t.YNc(35,dn,24,15,"tr",5),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.s9C("nzTitle",t.lcZ(1,16,"product.request")),t.xp6(7),t.Oqu(t.lcZ(8,18,"common.product")),t.xp6(4),t.Oqu(t.lcZ(12,20,"product.request")),t.xp6(3),t.Q6J("nzData",n.requests)("nzFrontPagination",!1)("nzTotal",n.requestsCount)("nzPageIndex",n.pageIndex)("nzPageSize",n.pageSize)("nzLoading",n.loading),t.xp6(6),t.Oqu(t.lcZ(21,22,"common.user")),t.xp6(3),t.Oqu(t.lcZ(24,24,"common.content")),t.xp6(3),t.Oqu(t.lcZ(27,26,"common.image")),t.xp6(3),t.Oqu(t.lcZ(30,28,"common.created_at")),t.xp6(3),t.Oqu(t.lcZ(33,30,"common.status")),t.xp6(3),t.Q6J("ngForOf",n.requests)("ngForTrackBy",n.trackById))},directives:[s.$O,S.Dg,s.A2,S.MO,Ot.w,X.Ls,At.bd,v.N8,v.Om,v.$Z,v.Uo,v._C,v.p0,A.sg,A.O5,It.ZU,v.bF,h.i,g.JJ,g.On,Jt.Z,$t.Dz,$.ix,Dt.dQ],pipes:[P.X$,A.uU,A.OU],styles:[".avatar[_ngcontent-%COMP%]{border-radius:50%;width:32px;height:32px;position:relative;overflow:hidden}.avatar[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}"]}),i})();var Kt=a(9220);const cn=[{path:"new",component:Wt,resolve:{product:Kt.M}},{path:"requests",component:un},{path:":id",component:Wt,resolve:{product:Kt.M}},{path:"",pathMatch:"full",component:on}];let gn=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[Q.Bz.forChild(cn)],Q.Bz]}),i})();var pn=a(7615),mn=a(8812);let hn=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[A.ez,gn,g.u5,g.UX,Tt.JF,bt.xu,pn.m,mn.IngredientModule,P.aw.forChild(),s.KJ,S.lt,v.HQ,At.vh,J.gR,St.X,It.ZJ,$.sL,X.PV,k.U5,E.Jb,Ut.cq,U.o7,Mt.Z,Y.LV,m.Z_,b.cS,p.Wr,h.m,q.A0,B.cg,Lt.aF,$t.Rt,ee.Qp,Qt.BL]]}),i})()}}]);